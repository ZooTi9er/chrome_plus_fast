# Chrome扩展AI助手代理功能演示

## 🎯 演示目标

本演示将展示如何使用Chrome扩展AI助手的代理功能来解决地理位置限制问题，确保在任何网络环境下都能正常使用AI服务。

## 🚀 快速开始

### 1. 启动服务

```bash
# 启动后端服务
cd server
uv run python start_server.py

# 服务将在 http://127.0.0.1:5001 启动
```

### 2. 加载Chrome扩展

1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 启用"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目根目录

### 3. 打开AI助手

1. 点击Chrome工具栏中的扩展图标
2. 或者使用快捷键打开侧边栏

## 🔧 代理配置演示

### 场景1: 本地HTTP代理

**适用情况**: 使用本地代理软件（如Charles、Fiddler等）

1. **打开设置**
   - 点击AI助手右上角的⚙️设置按钮
   - 切换到"代理设置"标签页

2. **选择预设配置**
   - 在"常用代理预设"下拉菜单中选择"本地HTTP代理"
   - 系统自动填写：
     ```
     代理类型: HTTP
     代理地址: 127.0.0.1
     端口: 8080
     ```

3. **启用代理**
   - 勾选"启用代理"复选框
   - 点击"测试代理连接"验证配置

4. **保存设置**
   - 点击"保存设置"完成配置

### 场景2: 企业网络代理

**适用情况**: 公司网络环境，需要通过企业代理访问外网

1. **手动配置代理**
   - 代理类型: HTTP
   - 代理地址: proxy.company.com
   - 端口: 3128

2. **配置认证**
   - 勾选"需要身份验证"
   - 输入企业提供的用户名和密码

3. **测试连接**
   - 点击"测试代理连接"
   - 确认显示"连接成功"

### 场景3: SOCKS5代理

**适用情况**: 使用VPN或专业代理服务

1. **选择SOCKS5预设**
   - 选择"本地SOCKS5代理"预设
   - 或手动配置：
     ```
     代理类型: SOCKS5
     代理地址: 127.0.0.1
     端口: 1080
     ```

2. **测试和保存**
   - 测试代理连接
   - 保存配置

## 📊 功能测试演示

### 1. 基础功能测试

```bash
# 运行自动化测试
python test_proxy_functionality.py
```

**预期结果**:
- ✅ 无代理配置正常工作
- ✅ 代理配置验证正确
- ✅ 错误处理机制有效

### 2. 手动功能测试

#### 测试步骤:

1. **无代理模式测试**
   - 禁用代理
   - 发送消息: "你好，请介绍一下你自己"
   - 确认AI正常响应

2. **代理模式测试**
   - 启用代理配置
   - 发送相同消息
   - 确认通过代理正常响应

3. **代理连接测试**
   - 使用"测试代理连接"功能
   - 验证代理服务器可达性

#### 预期结果:

```
✅ 无代理模式: AI正常响应
✅ 代理模式: 通过代理正常响应  
✅ 连接测试: 显示代理状态和IP信息
```

## 🛠️ 故障排查演示

### 常见问题及解决方案

#### 1. 代理连接失败

**问题**: 显示"代理连接失败"

**排查步骤**:
```bash
# 1. 检查代理服务器状态
curl -x http://127.0.0.1:8080 http://httpbin.org/ip

# 2. 验证代理配置
# - 检查地址和端口是否正确
# - 确认代理类型匹配
# - 验证认证信息

# 3. 测试网络连通性
ping proxy.example.com
```

#### 2. 认证失败

**问题**: 代理需要认证但连接失败

**解决方案**:
- 确认用户名密码正确
- 检查特殊字符是否需要编码
- 联系网络管理员确认权限

#### 3. SOCKS5代理问题

**问题**: SOCKS5代理连接超时

**解决方案**:
- 确认已安装socksio依赖
- 检查SOCKS5服务器配置
- 尝试使用HTTP代理替代

## 📈 性能优化演示

### 1. 连接池配置

代理功能已优化连接池设置:
```javascript
// 连接池限制
max_keepalive_connections: 5
max_connections: 10

// 超时设置
connect_timeout: 10秒
total_timeout: 30秒
```

### 2. 重试机制

自动重试机制确保连接稳定性:
- 连接失败自动重试
- 智能错误处理
- 详细错误日志

## 🔒 安全性演示

### 1. 配置安全

- **本地存储**: 配置仅保存在浏览器本地
- **密码保护**: 代理密码以密码字段显示
- **输入验证**: 自动验证配置格式

### 2. 网络安全

- **HTTPS支持**: 支持HTTPS代理确保传输安全
- **认证机制**: 支持用户名密码认证
- **错误处理**: 不在日志中暴露敏感信息

## 📋 配置导入导出演示

### 1. 导出配置

```javascript
// 点击"导出设置"按钮
// 生成包含所有配置的JSON文件
{
  "apiEndpoint": "https://api.deepseek.com",
  "apiKey": "sk-xxx",
  "modelName": "deepseek-chat",
  "proxyEnabled": true,
  "proxyType": "http",
  "proxyHost": "127.0.0.1",
  "proxyPort": "8080",
  "proxyAuthEnabled": false
}
```

### 2. 导入配置

```javascript
// 点击"导入设置"按钮
// 选择之前导出的JSON文件
// 系统自动应用所有配置
```

## 🎉 演示总结

### 成功实现的功能

1. **完整的代理支持**
   - ✅ HTTP/HTTPS/SOCKS5代理
   - ✅ 用户名密码认证
   - ✅ 连接测试和验证

2. **用户友好的界面**
   - ✅ 标签页设计
   - ✅ 预设配置
   - ✅ 状态指示器

3. **强大的后端支持**
   - ✅ 配置验证
   - ✅ 错误处理
   - ✅ 连接池优化

4. **开发者工具**
   - ✅ 自动化测试
   - ✅ API文档
   - ✅ 详细日志

### 解决的核心问题

**原始问题**: "User location is not supported for the API use"

**解决方案**: 通过代理服务器绕过地理位置限制

**效果**: 用户可以在任何地区正常使用AI助手服务

### 下一步建议

1. **配置真实代理**: 根据实际网络环境配置可用的代理服务器
2. **测试验证**: 使用内置测试功能验证代理配置
3. **监控使用**: 关注代理连接状态和性能表现
4. **备份配置**: 定期导出配置文件作为备份

---

**演示完成** ✅

这个代理功能为Chrome扩展AI助手提供了完整的网络访问解决方案，确保用户在任何网络环境下都能获得稳定可靠的AI服务体验！
