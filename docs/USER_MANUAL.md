# Chrome Plus V2.0 用户使用手册

## 📋 文档信息

| 项目名称 | Chrome Plus V2.0 |
|---------|------------------|
| 版本 | 2.0.0 |
| 目标用户 | 最终用户 |
| 最后更新 | 2024-12 |

## 📖 目录

1. [功能概述](#1-功能概述)
2. [系统要求](#2-系统要求)
3. [安装指南](#3-安装指南)
4. [快速开始](#4-快速开始)
5. [界面介绍](#5-界面介绍)
6. [功能使用教程](#6-功能使用教程)
7. [配置选项](#7-配置选项)
8. [常见问题](#8-常见问题)
9. [故障排除](#9-故障排除)
10. [最佳实践](#10-最佳实践)
11. [版本更新](#11-版本更新)

## 1. 功能概述

### 1.1 什么是Chrome Plus V2.0？

Chrome Plus V2.0是一款智能AI助手Chrome扩展，为您提供便捷的AI聊天体验。通过侧边栏界面，您可以与多种AI模型进行实时对话，获得智能回复和帮助。

### 1.2 核心特性

#### 🚀 **实时通信体验**
- **WebSocket实时通信**: 消息即时发送和接收，无需等待
- **连接状态显示**: 实时显示连接状态和通信模式
- **自动重连**: 网络中断时自动重新连接
- **智能降级**: WebSocket不可用时自动切换到HTTP模式

#### 🤖 **强大的AI功能**
- **多模型支持**: 支持DeepSeek、OpenAI等多种AI模型
- **流式响应**: 实时显示AI生成过程，提升交互体验
- **智能对话**: 上下文理解，支持连续对话
- **Markdown渲染**: 完美显示格式化文本和代码

#### 🎨 **优秀的用户体验**
- **侧边栏设计**: 不干扰正常浏览，随时可用
- **代码高亮**: 多种编程语言语法高亮显示
- **响应式界面**: 适配不同屏幕尺寸
- **主题支持**: 支持明暗主题切换

#### ⚙️ **灵活的配置选项**
- **代理设置**: 支持HTTP/SOCKS代理配置
- **模型参数**: 可调节温度、最大令牌数等参数
- **个性化设置**: 自定义界面和行为偏好

### 1.3 V2.0新特性

| 特性 | V1.0 | V2.0 |
|------|------|------|
| 通信方式 | HTTP请求 | WebSocket实时通信 |
| 响应速度 | 较慢 | 实时响应 |
| 连接状态 | 无显示 | 实时状态指示 |
| 错误恢复 | 手动重试 | 自动重连和降级 |
| 任务处理 | 同步阻塞 | 异步非阻塞 |
| 扩展性 | 有限 | 高度可扩展 |

## 2. 系统要求

### 2.1 浏览器要求

- **Chrome浏览器**: 版本88或更高
- **开发者模式**: 需要启用开发者模式来安装扩展
- **网络连接**: 稳定的互联网连接

### 2.2 服务器要求

#### 本地部署
- **操作系统**: Windows 10+、macOS 10.15+、Linux (Ubuntu 18.04+)
- **Docker**: Docker 20.10+ 和 Docker Compose 2.0+
- **内存**: 至少2GB可用内存
- **存储**: 至少1GB可用磁盘空间

#### 云端部署
- **服务器**: 1核2GB内存的云服务器
- **网络**: 公网IP和域名（可选）
- **端口**: 5001端口用于API服务，5555端口用于监控（可选）

### 2.3 网络要求

- **出站连接**: 需要访问AI模型API（如api.deepseek.com）
- **代理支持**: 支持HTTP/SOCKS代理（如果需要）
- **WebSocket**: 支持WebSocket连接（现代浏览器默认支持）

## 3. 安装指南

### 3.1 下载项目

#### 方式一：Git克隆（推荐）
```bash
git clone https://github.com/your-username/chrome_plus.git
cd chrome_plus
```

#### 方式二：下载ZIP包
1. 访问项目GitHub页面
2. 点击"Code" → "Download ZIP"
3. 解压到本地目录

### 3.2 启动后端服务

#### 方式一：一键启动（推荐）
```bash
# 使用V2.0启动脚本
./start-v2.sh
```

#### 方式二：Docker Compose
```bash
# 启动所有服务
docker-compose up -d --build

# 查看服务状态
docker-compose ps
```

#### 方式三：手动启动
```bash
# 启动Redis
docker run -d --name redis -p 6379:6379 redis:7-alpine

# 启动后端服务
cd server
pip install -r requirements.txt
uvicorn main:app --host 0.0.0.0 --port 5001

# 启动Celery Worker
celery -A tasks worker --loglevel=info
```

### 3.3 验证服务

#### 快速验证
```bash
# 运行快速测试脚本
python3 quick_test.py
```

#### 手动验证
1. 访问健康检查端点：http://localhost:5001/health
2. 查看任务监控界面：http://localhost:5555（如果启用）
3. 检查服务日志：`docker-compose logs`

### 3.4 安装Chrome扩展

#### 步骤详解
1. **打开Chrome浏览器**
2. **访问扩展管理页面**
   - 地址栏输入：`chrome://extensions/`
   - 或者：菜单 → 更多工具 → 扩展程序
3. **启用开发者模式**
   - 点击右上角的"开发者模式"开关
4. **加载扩展**
   - 点击"加载已解压的扩展程序"
   - 选择项目根目录（包含manifest.json的文件夹）
   - 点击"选择文件夹"
5. **验证安装**
   - 扩展列表中出现"Chrome Plus V2.0"
   - 浏览器工具栏出现扩展图标

#### 常见安装问题
- **权限错误**: 确保选择了正确的项目根目录
- **Manifest错误**: 检查manifest.json文件格式
- **图标不显示**: 确保images文件夹中有图标文件

## 4. 快速开始

### 4.1 首次使用

#### 第一步：打开扩展
1. 点击浏览器工具栏中的Chrome Plus图标
2. 或者使用快捷键（如果设置了）
3. 侧边栏将自动打开

#### 第二步：检查连接状态
- 查看界面顶部的连接状态指示器
- 绿色表示WebSocket连接正常
- 黄色表示HTTP模式
- 红色表示连接异常

#### 第三步：发送第一条消息
1. 在输入框中输入您的问题
2. 点击发送按钮或按Enter键
3. 等待AI回复

### 4.2 基本操作

#### 发送消息
```
输入框 → 输入文本 → 点击发送 → 查看回复
```

#### 查看历史
- 所有对话历史自动保存
- 向上滚动查看历史消息
- 支持搜索历史对话（计划功能）

#### 复制回复
- 点击回复消息右上角的复制按钮
- 或者选中文本后右键复制

### 4.3 示例对话

#### 简单问答
```
用户: 你好，请介绍一下自己
AI: 您好！我是Chrome Plus V2.0的AI助手...
```

#### 代码相关
```
用户: 请写一个Python的Hello World程序
AI: 当然！这是一个简单的Python Hello World程序：

```python
print("Hello, World!")
```

这个程序会在控制台输出"Hello, World!"...
```

#### 技术问题
```
用户: 什么是WebSocket？
AI: WebSocket是一种网络通信协议...

## 5. 界面介绍

### 5.1 主界面布局

Chrome Plus V2.0采用侧边栏设计，主要包含以下区域：

```
┌─────────────────────────────────┐
│ 🔗 连接状态指示器               │
├─────────────────────────────────┤
│                                 │
│        对话历史区域             │
│                                 │
│  👤 用户: 您的消息              │
│  🤖 AI: AI的回复                │
│                                 │
├─────────────────────────────────┤
│ 📝 消息输入框                   │
│ [发送] [设置] [清空]            │
└─────────────────────────────────┘
```

### 5.2 界面元素详解

#### 5.2.1 连接状态指示器
位于界面顶部，显示当前连接状态：

- **🟢 WebSocket已连接**: 实时通信模式，响应最快
- **🟡 HTTP模式**: 降级模式，功能正常但响应稍慢
- **🔴 连接异常**: 服务不可用，请检查网络或服务状态
- **🔄 重连中**: 正在尝试重新建立连接

#### 5.2.2 对话历史区域
- **自动滚动**: 新消息自动滚动到底部
- **历史保存**: 对话历史自动保存到本地
- **消息格式**: 支持Markdown格式显示
- **代码高亮**: 自动识别并高亮代码块
- **复制功能**: 点击消息右上角复制按钮

#### 5.2.3 消息输入区域
- **输入框**: 支持多行文本输入
- **发送按钮**: 点击发送或使用Ctrl+Enter快捷键
- **设置按钮**: 打开配置面板
- **清空按钮**: 清空当前对话历史

### 5.3 快捷键

| 快捷键 | 功能 |
|--------|------|
| Ctrl + Enter | 发送消息 |
| Ctrl + L | 清空对话 |
| Ctrl + , | 打开设置 |
| Esc | 关闭设置面板 |

## 6. 功能使用教程

### 6.1 基础聊天功能

#### 6.1.1 发送文本消息
1. 在输入框中输入您的问题或消息
2. 点击"发送"按钮或按Ctrl+Enter
3. 等待AI回复，回复会实时显示

**示例：**
```
用户: 请解释一下什么是人工智能？
AI: 人工智能（Artificial Intelligence，简称AI）是指...
```

#### 6.1.2 多行消息
- 按Shift+Enter换行
- 支持发送长文本和多段落内容
- 自动保持格式

#### 6.1.3 代码相关对话
Chrome Plus V2.0特别优化了代码相关的对话体验：

**请求代码示例：**
```
用户: 请写一个JavaScript函数来计算斐波那契数列
AI: 这里是一个计算斐波那契数列的JavaScript函数：

```javascript
function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

// 使用示例
console.log(fibonacci(10)); // 输出: 55
```

这个函数使用递归方法计算斐波那契数列...
```

**代码解释：**
```
用户: 请解释这段Python代码的作用：
def quicksort(arr):
    if len(arr) <= 1:
        return arr
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    return quicksort(left) + middle + quicksort(right)

AI: 这是一个快速排序算法的Python实现...
```

### 6.2 高级功能

#### 6.2.1 上下文对话
AI会记住对话上下文，支持连续对话：

```
用户: 请介绍一下Python
AI: Python是一种高级编程语言...

用户: 它有什么优点？
AI: Python的主要优点包括：
1. 语法简洁易读
2. 丰富的库生态
3. 跨平台支持
...
```

#### 6.2.2 文件操作（如果启用）
如果后端启用了文件操作功能，您可以：

```
用户: 请创建一个名为test.txt的文件，内容是"Hello World"
AI: 我已经为您创建了test.txt文件，内容如下：
文件名: test.txt
内容: Hello World
文件已成功保存到沙箱目录。
```

#### 6.2.3 实时状态反馈
V2.0版本提供实时的处理状态反馈：

- **正在处理**: 显示"AI正在思考..."
- **处理进度**: 显示任务处理进度（如果适用）
- **完成通知**: 处理完成后立即显示结果

### 6.3 消息管理

#### 6.3.1 复制消息
- 点击任意消息右上角的复制图标
- 或者选中文本后右键复制
- 支持复制格式化的Markdown内容

#### 6.3.2 清空对话
- 点击"清空"按钮清空当前对话
- 或使用快捷键Ctrl+L
- 清空操作不可撤销，请谨慎使用

#### 6.3.3 导出对话（计划功能）
未来版本将支持：
- 导出对话为Markdown文件
- 导出对话为PDF
- 分享对话链接

## 7. 配置选项

### 7.1 打开设置面板

点击界面底部的"设置"按钮或使用快捷键Ctrl+,打开设置面板。

### 7.2 API配置

#### 7.2.1 模型选择
```json
{
  "model": "deepseek-chat",
  "options": [
    "deepseek-chat",
    "gpt-3.5-turbo",
    "gpt-4"
  ]
}
```

#### 7.2.2 模型参数
- **温度 (Temperature)**: 0.0-2.0，控制回复的随机性
  - 0.0: 最确定的回复
  - 1.0: 平衡的回复（推荐）
  - 2.0: 最有创意的回复

- **最大令牌数 (Max Tokens)**: 控制回复的最大长度
  - 建议范围: 1000-4000
  - 默认值: 4000

- **流式输出**: 是否启用实时显示AI生成过程
  - 推荐开启，提升交互体验

### 7.3 代理配置

如果您需要通过代理访问AI服务：

#### 7.3.1 HTTP代理
```json
{
  "proxy": {
    "enabled": true,
    "type": "http",
    "host": "127.0.0.1",
    "port": 7890,
    "username": "",
    "password": ""
  }
}
```

#### 7.3.2 SOCKS代理
```json
{
  "proxy": {
    "enabled": true,
    "type": "socks5",
    "host": "127.0.0.1",
    "port": 1080,
    "username": "",
    "password": ""
  }
}
```

### 7.4 界面配置

#### 7.4.1 主题设置
- **浅色主题**: 适合白天使用
- **深色主题**: 适合夜间使用
- **自动切换**: 跟随系统主题

#### 7.4.2 显示选项
- **自动滚动**: 新消息自动滚动到底部
- **显示时间戳**: 显示消息发送时间
- **代码高亮**: 启用代码语法高亮
- **Markdown渲染**: 启用Markdown格式显示

### 7.5 高级配置

#### 7.5.1 连接设置
- **优先使用WebSocket**: 默认启用
- **自动重连**: 连接断开时自动重连
- **重连次数**: 最大重连尝试次数（默认5次）
- **心跳间隔**: WebSocket心跳检测间隔（默认30秒）

#### 7.5.2 性能设置
- **消息缓存**: 本地缓存消息数量
- **历史保存**: 保存对话历史的天数
- **预加载**: 预加载常用资源

## 8. 常见问题

### 8.1 安装相关

#### Q: 扩展安装后图标不显示？
**A:** 检查以下几点：
1. 确保选择了正确的项目根目录
2. 检查images文件夹是否包含图标文件
3. 重新加载扩展或重启Chrome浏览器

#### Q: 提示"Manifest文件错误"？
**A:**
1. 检查manifest.json文件格式是否正确
2. 确保文件编码为UTF-8
3. 验证JSON语法是否有误

#### Q: 扩展加载成功但无法使用？
**A:**
1. 检查后端服务是否正常启动
2. 访问http://localhost:5001/health验证服务状态
3. 查看浏览器控制台是否有错误信息

### 8.2 连接相关

#### Q: 连接状态显示红色，无法使用？
**A:** 按以下步骤排查：
1. **检查服务状态**:
   ```bash
   # 检查Docker服务
   docker-compose ps

   # 检查端口占用
   netstat -an | grep 5001
   ```

2. **重启服务**:
   ```bash
   # 重启所有服务
   docker-compose restart

   # 或使用启动脚本
   ./start-v2.sh
   ```

3. **检查防火墙**: 确保5001端口未被防火墙阻止

#### Q: WebSocket连接失败，自动降级到HTTP？
**A:** 这是正常的降级机制：
- WebSocket连接失败时自动切换到HTTP模式
- 功能完全正常，只是响应稍慢
- 可以尝试刷新页面重新建立WebSocket连接

#### Q: 消息发送后没有回复？
**A:**
1. 检查API密钥是否正确配置
2. 确认网络连接正常
3. 查看浏览器控制台错误信息
4. 检查代理设置是否正确（如果使用代理）

### 8.3 功能相关

#### Q: AI回复内容不完整或被截断？
**A:**
1. 增加最大令牌数设置（在设置面板中）
2. 检查网络连接稳定性
3. 尝试分段提问，避免单次请求过长

#### Q: 代码高亮不显示？
**A:**
1. 确保在设置中启用了"代码高亮"选项
2. 检查代码块格式是否正确（使用```包围）
3. 刷新页面重新加载高亮库

#### Q: 如何保存对话历史？
**A:**
- 对话历史自动保存到浏览器本地存储
- 清除浏览器数据会删除历史记录
- 建议定期手动复制重要对话内容

### 8.4 性能相关

#### Q: 响应速度很慢？
**A:**
1. **检查连接模式**: WebSocket模式比HTTP模式更快
2. **网络优化**: 使用稳定的网络连接
3. **代理优化**: 如果使用代理，选择速度较快的代理服务器
4. **服务器资源**: 确保服务器有足够的CPU和内存资源

#### Q: 浏览器卡顿或崩溃？
**A:**
1. 清理对话历史（点击清空按钮）
2. 重启Chrome浏览器
3. 检查是否有其他扩展冲突
4. 更新Chrome到最新版本

## 9. 故障排除

### 9.1 诊断工具

#### 9.1.1 快速诊断脚本
```bash
# 运行快速诊断
python3 quick_test.py

# 查看详细测试结果
python3 test_chrome_plus_v2.py
```

#### 9.1.2 服务状态检查
```bash
# 检查所有服务状态
docker-compose ps

# 查看服务日志
docker-compose logs backend
docker-compose logs worker
docker-compose logs redis

# 检查端口占用
netstat -tulpn | grep :5001
netstat -tulpn | grep :6379
```

#### 9.1.3 浏览器控制台
1. 打开Chrome开发者工具（F12）
2. 查看Console标签页的错误信息
3. 查看Network标签页的网络请求状态

### 9.2 常见错误解决

#### 9.2.1 "Connection refused" 错误
**原因**: 后端服务未启动或端口被占用
**解决方案**:
```bash
# 检查端口占用
lsof -i :5001

# 杀死占用进程（如果需要）
kill -9 <PID>

# 重启服务
./start-v2.sh
```

#### 9.2.2 "API Key not found" 错误
**原因**: API密钥未配置或配置错误
**解决方案**:
1. 检查server/.env文件中的API密钥配置
2. 确保API密钥格式正确
3. 重启后端服务使配置生效

#### 9.2.3 "WebSocket connection failed" 错误
**原因**: WebSocket连接被阻止或服务异常
**解决方案**:
1. 检查防火墙设置
2. 确认WebSocket端口（5001）可访问
3. 系统会自动降级到HTTP模式，功能不受影响

#### 9.2.4 "Task timeout" 错误
**原因**: AI API响应超时
**解决方案**:
1. 检查网络连接稳定性
2. 验证代理设置（如果使用）
3. 尝试减少请求内容长度
4. 检查AI服务提供商状态

### 9.3 日志分析

#### 9.3.1 后端日志
```bash
# 查看FastAPI日志
docker-compose logs backend | tail -50

# 查看Celery Worker日志
docker-compose logs worker | tail -50

# 实时监控日志
docker-compose logs -f backend
```

#### 9.3.2 前端日志
1. 打开Chrome开发者工具
2. 查看Console标签页
3. 筛选Chrome Plus相关的日志信息

#### 9.3.3 Redis日志
```bash
# 查看Redis日志
docker-compose logs redis

# 连接Redis查看状态
docker exec -it chrome_plus_redis redis-cli
> INFO
> PING
```

### 9.4 重置和恢复

#### 9.4.1 重置扩展
1. 在Chrome扩展管理页面禁用扩展
2. 重新启用扩展
3. 或者重新加载扩展

#### 9.4.2 重置服务
```bash
# 停止所有服务
docker-compose down

# 清理数据（谨慎使用）
docker-compose down -v

# 重新构建和启动
docker-compose up -d --build
```

#### 9.4.3 重置配置
1. 清除浏览器扩展数据：
   - 右键扩展图标 → 选项 → 重置设置
2. 重置服务器配置：
   - 恢复server/.env.example为server/.env
   - 重新配置API密钥

## 10. 最佳实践

### 10.1 使用建议

#### 10.1.1 提问技巧
- **明确具体**: 提供清晰、具体的问题描述
- **上下文**: 提供必要的背景信息
- **分步骤**: 复杂问题可以分步骤提问
- **示例**: 提供具体的例子或场景

**好的提问示例**:
```
用户: 我正在学习Python，想要创建一个简单的Web API。
请帮我写一个使用Flask框架的Hello World示例，
包括路由定义和JSON响应。
```

**避免的提问方式**:
```
用户: 帮我写代码
```

#### 10.1.2 代码相关最佳实践
- **指定语言**: 明确说明需要的编程语言
- **说明用途**: 解释代码的具体用途和需求
- **提供上下文**: 说明项目背景和技术栈
- **要求解释**: 请求代码解释和使用说明

#### 10.1.3 长对话管理
- **定期清空**: 长时间对话后适当清空历史
- **重新开始**: 切换话题时考虑重新开始对话
- **保存重要内容**: 及时复制保存重要的回复内容

### 10.2 性能优化

#### 10.2.1 网络优化
- **稳定连接**: 使用稳定的网络连接
- **代理选择**: 选择速度快、稳定的代理服务器
- **避免高峰**: 避免在网络高峰期使用

#### 10.2.2 资源管理
- **定期清理**: 定期清理对话历史和缓存
- **关闭不用的标签**: 减少浏览器内存占用
- **更新浏览器**: 保持Chrome浏览器最新版本

#### 10.2.3 服务器优化
- **资源监控**: 定期检查服务器资源使用情况
- **日志清理**: 定期清理服务器日志文件
- **更新维护**: 定期更新Docker镜像和依赖包

### 10.3 安全建议

#### 10.3.1 API密钥安全
- **妥善保管**: 不要在公共场所暴露API密钥
- **定期更换**: 定期更换API密钥
- **权限控制**: 使用最小权限原则配置API密钥

#### 10.3.2 数据安全
- **敏感信息**: 避免在对话中包含敏感个人信息
- **定期清理**: 定期清理本地存储的对话历史
- **网络安全**: 在安全的网络环境中使用

#### 10.3.3 隐私保护
- **本地处理**: 对话历史仅保存在本地浏览器
- **数据传输**: 所有数据传输使用加密连接
- **第三方服务**: 了解AI服务提供商的隐私政策

## 11. 版本更新

### 11.1 V2.0更新内容

#### 11.1.1 重大升级
- **架构升级**: 从HTTP同步模式升级为WebSocket实时通信
- **异步处理**: 引入Celery异步任务处理机制
- **微服务架构**: 采用Docker容器化微服务部署
- **实时反馈**: 提供实时的连接状态和处理进度反馈

#### 11.1.2 新增功能
- **WebSocket实时通信**: 双向实时消息传输
- **自动重连机制**: 网络中断时自动重新连接
- **智能降级**: WebSocket不可用时自动切换到HTTP模式
- **任务监控**: Flower监控界面查看任务处理状态
- **容器化部署**: Docker Compose一键部署所有服务

#### 11.1.3 性能改进
- **响应速度**: 实时通信大幅提升响应速度
- **并发处理**: 支持多用户同时使用
- **资源优化**: 优化内存和CPU使用
- **错误处理**: 增强的错误处理和恢复机制

### 11.2 升级指南

#### 11.2.1 从V1.0升级
如果您正在使用V1.0版本，请按以下步骤升级：

1. **备份数据**: 导出重要的对话历史
2. **停止旧服务**: 停止V1.0版本的服务
3. **更新代码**: 拉取最新的V2.0代码
4. **重新部署**: 使用新的部署方式启动服务
5. **更新扩展**: 重新加载Chrome扩展

#### 11.2.2 配置迁移
V2.0版本的配置文件有所变化：
- 新增Redis配置
- 新增Celery配置
- WebSocket相关配置
- 详细配置请参考server/.env.example

### 11.3 未来规划

#### 11.3.1 计划功能
- **对话搜索**: 搜索历史对话内容
- **对话导出**: 导出对话为Markdown/PDF
- **主题定制**: 更多主题和自定义选项
- **插件系统**: 支持第三方插件扩展
- **多语言支持**: 界面多语言本地化

#### 11.3.2 性能优化
- **缓存优化**: 智能缓存机制
- **压缩传输**: 消息压缩减少带宽占用
- **离线支持**: 基础功能离线可用
- **移动适配**: 移动设备界面优化

### 11.4 更新通知

#### 11.4.1 获取更新
- **GitHub**: 关注项目GitHub仓库获取最新版本
- **Release Notes**: 查看详细的版本更新说明
- **自动检查**: 扩展会自动检查新版本（计划功能）

#### 11.4.2 更新频率
- **主版本**: 重大功能更新，每6-12个月
- **次版本**: 新功能和改进，每1-3个月
- **修复版本**: 错误修复，根据需要随时发布

---

## 📝 总结

Chrome Plus V2.0为您提供了强大而便捷的AI助手体验。通过本用户手册，您应该能够：

- ✅ 成功安装和配置Chrome Plus V2.0
- ✅ 熟练使用各项功能进行AI对话
- ✅ 根据需要调整配置选项
- ✅ 解决常见问题和故障
- ✅ 遵循最佳实践获得最佳体验

如果您在使用过程中遇到问题，请：
1. 首先查阅本手册的相关章节
2. 运行诊断脚本检查系统状态
3. 查看GitHub Issues寻找解决方案
4. 提交新的Issue报告问题

感谢您使用Chrome Plus V2.0！我们致力于为您提供最好的AI助手体验。
```
```

**步骤5: 安装Chrome扩展**
1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目根目录

#### 验证安装

**测试后端服务**
```bash
curl -X POST "http://127.0.0.1:5001/chat" \
  -H "Content-Type: application/json" \
  -d '{"message": "你好"}'
```

预期响应：
```json
{"response": "你好！我是ShellAI，一个专注于文件和目录操作的助手..."}
```

**测试Chrome扩展**
1. 点击Chrome工具栏中的扩展图标
2. 在侧边栏中输入"你好"
3. 应该收到AI助手的回复

---

## 2. 安装指南

### 2.1 系统要求

#### 必需软件
- **Chrome浏览器**: 版本 88+ (支持Manifest V3)
- **Python**: 3.10+
- **uv**: Python包管理器

#### 推荐配置
- **内存**: 4GB以上
- **存储**: 500MB可用空间
- **网络**: 稳定的互联网连接

### 2.2 详细安装步骤

#### 步骤1: 安装Python和uv

**macOS (使用Homebrew)**
```bash
brew install python@3.10
curl -LsSf https://astral.sh/uv/install.sh | sh
```

**Windows (使用Chocolatey)**
```bash
choco install python
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

**Linux (Ubuntu/Debian)**
```bash
sudo apt update
sudo apt install python3.10 python3.10-venv
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### 步骤2: 下载项目
```bash
git clone <repository-url>
cd chrome_plus
```

#### 步骤3: 安装后端依赖
```bash
cd server
uv sync
```

#### 步骤4: 配置环境变量
```bash
# 创建.env文件
cp .env.example .env

# 编辑.env文件，添加API密钥
DEEPSEEK_API_KEY=your_deepseek_api_key_here
TAVILY_API_KEY=your_tavily_api_key_here  # 可选
```

#### 步骤5: 启动后端服务
```bash
cd server
uv run python start_server.py
```

#### 步骤6: 安装Chrome扩展

**开发模式安装**
1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"开关
4. 点击"加载已解压的扩展程序"按钮
5. 选择chrome_plus项目根目录
6. 确认安装

**验证安装成功**
- Chrome工具栏出现扩展图标
- 点击图标打开侧边栏
- 侧边栏显示AI助手界面

### 2.3 API密钥获取

#### DeepSeek API密钥（必需）
1. 访问 [DeepSeek官网](https://platform.deepseek.com/)
2. 注册账号（支持邮箱注册）
3. 登录后进入控制台
4. 创建新的API密钥
5. 复制密钥到.env文件

#### Tavily API密钥（可选）
1. 访问 [Tavily官网](https://tavily.com/)
2. 注册账号
3. 获取免费API密钥
4. 添加到.env文件（用于网络搜索功能）

---

## 3. 基础功能使用

### 3.1 启动和界面

#### 打开AI助手
- **方法1**: 点击Chrome工具栏中的扩展图标
- **方法2**: 使用快捷键（如果已设置）
- **方法3**: 右键点击扩展图标选择"打开侧边栏"

#### 界面介绍
```
┌─────────────────────────────────┐
│ Chrome扩展AI助手        ⚙️ 设置 │
├─────────────────────────────────┤
│                                 │
│  聊天消息显示区域                │
│                                 │
│  [用户消息]                     │
│  [AI回复消息]                   │
│                                 │
├─────────────────────────────────┤
│ [输入框]              [发送]    │
└─────────────────────────────────┘
```

### 3.2 基础对话功能

#### 发送消息
1. 在底部输入框中输入您的问题
2. 按Enter键或点击"发送"按钮
3. 等待AI助手回复

#### 消息类型
- **文本消息**: 普通对话和问答
- **代码请求**: 请求编程帮助
- **文件操作**: 文件和目录管理
- **信息查询**: 获取各种信息

#### 示例对话
```
用户: 你好，请介绍一下你自己
AI: 你好！我是ShellAI，一个专注于文件和目录操作的助手...

用户: 请创建一个名为test.txt的文件
AI: 我来为您创建test.txt文件...

用户: 显示当前目录的文件列表
AI: 当前目录包含以下文件...
```

### 3.3 文件操作功能

#### 支持的文件操作
- **创建文件**: "请创建一个名为example.txt的文件"
- **读取文件**: "请读取example.txt的内容"
- **写入文件**: "请在example.txt中写入'Hello World'"
- **删除文件**: "请删除example.txt文件"
- **列出文件**: "显示当前目录的文件列表"
- **创建目录**: "请创建一个名为docs的目录"

#### 安全限制
- 所有文件操作限制在安全沙箱目录内
- 无法访问系统敏感文件
- 自动备份重要操作

### 3.4 Markdown和代码显示

#### Markdown渲染
AI助手的回复支持完整的Markdown格式：
- **标题**: # ## ### 
- **列表**: - * 1. 2.
- **代码块**: ```python ```
- **链接**: [文本](URL)
- **表格**: | 列1 | 列2 |

#### 代码高亮
支持多种编程语言的语法高亮：
- Python, JavaScript, Java
- HTML, CSS, SQL
- Bash, PowerShell
- 以及更多语言

---

## 4. 代理功能配置

### 4.1 代理功能概述

代理功能帮助您解决以下问题：
- **地理位置限制**: 绕过"User location is not supported"错误
- **网络访问限制**: 在企业网络环境中正常使用
- **连接稳定性**: 通过代理服务器提高连接质量

### 4.2 打开代理设置

1. 点击AI助手界面右上角的 ⚙️ **设置按钮**
2. 在弹出的设置窗口中，点击 **"代理设置"** 标签页

### 4.3 代理配置方法

#### 方法1: 使用预设配置（推荐新手）

1. 在 **"常用代理预设"** 下拉菜单中选择：
   - `本地HTTP代理 (127.0.0.1:8080)` - 适用于本地代理软件
   - `本地SOCKS5代理 (127.0.0.1:1080)` - 适用于VPN或SOCKS5代理
   - `Squid默认配置 (127.0.0.1:3128)` - 适用于Squid代理服务器

2. 系统会自动填写代理配置

#### 方法2: 手动配置

**启用代理**
- 勾选 ✅ **"启用代理"** 复选框

**选择代理类型**
- `HTTP` - 最常用，适合大多数代理服务器
- `HTTPS` - 加密HTTP代理
- `SOCKS5` - 支持所有TCP流量，适合VPN

**填写代理信息**
```
代理地址: 您的代理服务器地址 (如: proxy.example.com)
端口: 代理端口号 (如: 3128, 8080, 1080)
```

**配置认证**（如果需要）
- 勾选 ✅ **"需要身份验证"**
- 输入代理服务器的用户名和密码

### 4.4 测试和保存

**测试连接**
1. 点击 **"测试代理连接"** 按钮
2. 等待测试结果：
   - ✅ **连接成功** - 代理配置正确，可以使用
   - ❌ **连接失败** - 请检查代理配置或联系代理服务提供商

**保存设置**
1. 确认代理测试成功后，点击 **"保存设置"** 按钮
2. 关闭设置窗口

**验证功能**
1. 在AI助手中发送一条测试消息
2. 确认AI正常响应，没有地理位置限制错误

### 4.5 常见代理配置示例

#### 企业网络代理
```
代理类型: HTTP
代理地址: proxy.company.com
端口: 3128
认证: 需要（使用公司提供的用户名密码）
```

#### 家用路由器代理
```
代理类型: HTTP
代理地址: 192.168.1.1
端口: 8080
认证: 通常不需要
```

#### VPN SOCKS5代理
```
代理类型: SOCKS5
代理地址: 127.0.0.1
端口: 1080
认证: 根据VPN软件设置
```

#### 云代理服务
```
代理类型: HTTP
代理地址: proxy-server.example.com
端口: 3128
认证: 需要（使用服务商提供的凭据）
```

---

## 5. 高级功能

### 5.1 自定义API配置

#### 更改API端点
1. 打开设置 → API配置标签页
2. 修改"API端点"字段
3. 支持OpenAI兼容的API服务

#### 更换AI模型
1. 在"模型名称"字段输入模型名
2. 常用模型：
   - `deepseek-chat` (默认)
   - `gpt-3.5-turbo`
   - `gpt-4`

#### API密钥管理
- 安全存储在Chrome本地存储中
- 支持多个API密钥配置
- 自动验证密钥有效性

### 5.2 配置导入导出

#### 导出配置
1. 在设置界面点击"导出设置"
2. 下载包含所有配置的JSON文件
3. 可用于备份或在其他设备上使用

#### 导入配置
1. 点击"导入设置"按钮
2. 选择之前导出的JSON文件
3. 系统自动应用所有配置

#### 配置文件格式
```json
{
  "apiEndpoint": "https://api.deepseek.com",
  "apiKey": "sk-xxx",
  "modelName": "deepseek-chat",
  "proxyEnabled": true,
  "proxyType": "http",
  "proxyHost": "127.0.0.1",
  "proxyPort": "8080",
  "proxyAuthEnabled": false
}
```

### 5.3 多环境配置

#### 为不同环境准备配置
- **家庭环境**: 无代理或家用代理
- **办公环境**: 企业代理配置
- **公共WiFi**: 安全代理配置
- **移动网络**: 优化的代理设置

#### 快速切换
1. 为每个环境导出配置文件
2. 根据当前环境快速导入相应配置
3. 使用预设配置快速应用常用设置

---

## 6. 常见问题解答

### 6.1 安装相关问题

**Q: 扩展无法加载怎么办？**
A: 检查manifest.json语法：
```bash
python3 -c "import json; json.load(open('manifest.json'))"
```

**Q: 后端服务启动失败？**
A: 检查以下几点：
1. Python版本是否为3.10+
2. 是否正确安装了uv
3. 端口5001是否被占用
4. API密钥是否正确设置

**Q: API请求失败？**
A: 确认服务器运行状态：
```bash
curl http://127.0.0.1:5001/docs
```

### 6.2 功能使用问题

**Q: AI不响应消息？**
A: 检查以下几点：
1. 后端服务是否正常运行
2. API密钥是否有效
3. 网络连接是否正常
4. 是否需要配置代理

**Q: 文件操作失败？**
A: 文件操作限制在安全沙箱目录内，检查：
1. 文件路径是否正确
2. 是否有足够的磁盘空间
3. 文件是否被其他程序占用

**Q: 代码高亮不显示？**
A: 确保：
1. 使用正确的代码块语法 ```language
2. 网络连接正常（需要加载highlight.js）
3. 浏览器支持JavaScript

### 6.3 代理相关问题

**Q: 代理连接失败？**
A: 检查：
1. 代理服务器地址和端口是否正确
2. 代理服务器是否正在运行
3. 网络是否能访问代理服务器
4. 认证信息是否正确

**Q: 设置代理后仍然有地理位置错误？**
A: 确认：
1. 代理确实已启用
2. 代理服务器位于支持的地区
3. 代理类型选择正确
4. 重启扩展后重试

**Q: 代理认证失败？**
A: 检查：
1. 用户名和密码是否正确
2. 是否包含特殊字符需要编码
3. 代理服务器是否支持认证
4. 账户是否被锁定或过期

---

## 7. 故障排除

### 7.1 Chrome扩展问题

#### 扩展无法加载
**症状**: Chrome扩展页面显示错误，无法加载扩展

**解决步骤**:
1. 检查manifest.json语法是否正确
2. 确认所有必需文件都存在
3. 查看Chrome扩展错误日志
4. 重新加载扩展

**检查命令**:
```bash
# 验证manifest.json语法
python3 -c "import json; json.load(open('manifest.json'))"
```

#### 侧边栏无法打开
**症状**: 点击扩展图标没有反应

**解决步骤**:
1. 检查权限配置是否正确
2. 确认sidePanel API可用
3. 查看background.js是否有错误
4. 重启Chrome浏览器

#### API请求失败
**症状**: 扩展界面显示网络错误

**解决步骤**:
1. 确认后端服务正在运行
2. 检查CORS配置
3. 验证host_permissions设置
4. 查看网络请求日志

### 7.2 后端服务问题

#### 服务启动失败
**症状**: 运行start_server.py时出错

**常见原因和解决方案**:

**端口占用**:
```bash
# 检查端口占用
lsof -i :5001
# 或者更改端口
export SERVER_PORT=5002
```

**依赖缺失**:
```bash
# 重新安装依赖
cd server
uv sync
```

**Python版本不兼容**:
```bash
# 检查Python版本
python --version
# 确保版本 >= 3.10
```

#### API密钥问题
**症状**: 服务启动但AI不响应

**解决步骤**:
1. 检查.env文件是否存在
2. 验证API密钥格式
3. 测试API密钥有效性
4. 检查API配额和限制

**验证命令**:
```bash
# 检查环境变量
cd server
python -c "import os; from dotenv import load_dotenv; load_dotenv(); print(os.getenv('DEEPSEEK_API_KEY'))"
```

#### 异步事件循环冲突
**症状**: 服务运行时出现事件循环错误

**解决方案**:
```python
# 在代码中使用线程池
import asyncio
import concurrent.futures

async def run_sync_in_thread(func, *args):
    loop = asyncio.get_event_loop()
    with concurrent.futures.ThreadPoolExecutor() as executor:
        return await loop.run_in_executor(executor, func, *args)
```

### 7.3 代理连接问题

#### 代理连接超时
**症状**: 代理测试显示连接超时

**排查步骤**:
1. 检查代理服务器是否可达
2. 验证代理端口是否正确
3. 确认网络防火墙设置
4. 尝试其他代理服务器

**测试命令**:
```bash
# 测试代理连接
curl -x http://proxy.example.com:8080 http://httpbin.org/ip

# 测试SOCKS5代理
curl --socks5 127.0.0.1:1080 http://httpbin.org/ip
```

#### 认证失败
**症状**: 代理需要认证但连接失败

**解决方案**:
1. 确认用户名密码正确
2. 检查特殊字符是否需要URL编码
3. 联系代理服务提供商
4. 尝试不同的认证方式

#### SOCKS5代理问题
**症状**: SOCKS5代理无法连接

**解决步骤**:
1. 确认已安装socksio依赖
2. 检查SOCKS5服务器配置
3. 验证端口和协议
4. 尝试使用HTTP代理替代

### 7.4 性能问题

#### 响应速度慢
**症状**: AI回复需要很长时间

**优化方案**:
1. 选择地理位置较近的代理
2. 避免使用过载的免费代理
3. 检查网络连接质量
4. 考虑升级API服务计划

#### 内存使用过高
**症状**: 浏览器或系统内存占用高

**解决方案**:
1. 定期清理聊天历史
2. 关闭不必要的标签页
3. 重启Chrome浏览器
4. 检查是否有内存泄漏

#### 文件操作慢
**症状**: 文件操作响应时间长

**优化建议**:
1. 避免操作大文件
2. 清理临时文件
3. 检查磁盘空间
4. 使用SSD存储

### 7.5 安全问题

#### API密钥泄露
**症状**: 担心API密钥安全性

**安全措施**:
1. 定期更换API密钥
2. 不要在公共场所输入密钥
3. 使用Chrome密码管理器
4. 监控API使用情况

#### 代理安全
**症状**: 担心代理服务器安全

**安全建议**:
1. 只使用可信的代理服务
2. 避免在代理上传输敏感信息
3. 定期更换代理密码
4. 使用HTTPS代理

### 7.6 日志和调试

#### 启用调试模式
```bash
# 后端调试
cd server
export DEBUG=true
uv run python start_server.py

# 前端调试
# 在Chrome DevTools中查看控制台
```

#### 查看日志文件
```bash
# 服务器日志
tail -f server/logs/app.log

# Chrome扩展日志
# 访问 chrome://extensions/ -> 点击"背景页"
```

#### 收集诊断信息
```bash
# 系统信息
python --version
uv --version
chrome --version

# 网络信息
curl -I http://127.0.0.1:5001/docs
ping api.deepseek.com

# 配置信息
cat server/.env | grep -v "API_KEY"
```

---

## 📞 获取帮助

### 技术支持渠道

1. **查看错误信息**: 仔细阅读错误提示，通常包含解决线索
2. **检查网络连接**: 确认基础网络连接正常
3. **查看文档**: 参考本用户手册和开发者文档
4. **社区支持**:
   - GitHub Issues: 报告问题和获取帮助
   - GitHub Discussions: 讨论和交流
   - 官方文档: 查看最新的使用指南

### 问题报告

在报告问题时，请提供以下信息：
- 操作系统和Chrome版本
- 扩展版本和配置信息
- 详细的错误信息和步骤
- 相关的日志文件

### 功能建议

我们欢迎您的功能建议和改进意见：
- 通过GitHub Issues提交功能请求
- 参与GitHub Discussions讨论
- 贡献代码和文档改进

---

## ✅ 成功使用指标

当您看到以下情况时，说明Chrome扩展AI助手配置和使用成功：

### 基础功能
- ✅ Chrome扩展正常加载，图标显示在工具栏
- ✅ 点击图标能正常打开侧边栏
- ✅ AI助手能正常响应消息
- ✅ Markdown和代码高亮正常显示
- ✅ 文件操作功能正常工作

### 代理功能
- ✅ 代理连接测试显示"连接成功"
- ✅ 通过代理能正常访问AI服务
- ✅ 没有地理位置限制错误
- ✅ 设置界面显示代理状态为"已启用"

### 高级功能
- ✅ 自定义API配置生效
- ✅ 配置导入导出功能正常
- ✅ 多环境配置切换顺畅
- ✅ 性能表现满足使用需求

---

**恭喜！** 🎉 您已成功掌握Chrome扩展AI助手的使用方法！

现在您可以：
- 💬 与AI助手进行智能对话
- 📁 执行安全的文件操作
- 🎨 享受优美的Markdown和代码显示
- 🌍 通过代理功能解决网络限制
- ⚙️ 自定义配置满足个人需求

开始探索AI助手的强大功能吧！ 🚀

---

*最后更新: 2024年12月*
*版本: 2.0.0*
