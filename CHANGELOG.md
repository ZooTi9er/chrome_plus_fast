# Chrome Plus 更新日志

本文档记录了Chrome Plus项目的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [2.0.0] - 2024-12-XX

### 🎉 重大升级
Chrome Plus V2.0 - 从传统HTTP架构升级为现代化WebSocket实时通信和微服务架构的重大版本！

### ✨ 新增功能

#### 🚀 实时通信架构
- **WebSocket支持**: 双向实时通信，告别HTTP轮询
- **连接状态指示器**: 实时显示连接状态和通信模式
- **自动降级机制**: WebSocket不可用时自动切换到HTTP模式
- **心跳检测**: 自动维护连接稳定性和重连机制

#### 🔄 异步任务处理
- **Celery集成**: 分布式任务队列处理长时间AI请求
- **Redis消息队列**: 高性能消息传递和结果存储
- **任务状态跟踪**: 实时显示任务处理进度和状态
- **并发处理**: 支持多用户同时使用，无阻塞处理

#### 🏗️ 微服务架构
- **API网关**: FastAPI + WebSocket服务网关
- **任务处理器**: 独立的Celery Worker服务
- **消息总线**: Redis发布/订阅系统
- **服务编排**: Docker Compose多服务管理

#### 🐳 容器化部署
- **Docker支持**: 完整的容器化配置和Dockerfile
- **一键部署**: Docker Compose自动化部署脚本
- **开发脚本**: 便捷的开发环境启动脚本
- **生产就绪**: 生产环境部署配置和监控

### 🔧 改进功能

#### 前端增强
- **WebSocket客户端**: 新增`websocket-api.js`实时通信客户端
- **API兼容层**: 更新`api.js`支持WebSocket和HTTP双模式
- **聊天界面**: 升级`chat.js`支持实时状态显示和流式响应
- **连接监控**: 实时连接状态、模式显示和错误处理

#### 后端重构
- **主应用**: 重构`main.py`支持WebSocket和应用生命周期管理
- **任务处理**: 新增`tasks.py`Celery任务定义和处理逻辑
- **依赖更新**: 升级`pyproject.toml`添加WebSocket、Celery、Redis支持
- **配置管理**: 新增环境配置文件和Docker环境变量

### 🧪 测试套件
- **架构测试**: `test_v2_architecture.py` WebSocket和Celery功能测试
- **综合测试**: `test_chrome_plus_v2.py` 端到端系统测试
- **快速验证**: `quick_test.py` 项目完整性检查
- **启动脚本**: `start-v2.sh` 一键启动和测试脚本

### 📚 文档更新
- **升级指南**: `UPGRADE_COMPLETE.md` 详细的V2.0升级说明
- **README更新**: 全面更新项目介绍和使用指南
- **架构文档**: 新架构设计和实现说明
- **部署指南**: Docker和生产环境部署指南

### 🔄 向后兼容
- **HTTP接口**: 保留HTTP API完全兼容性
- **配置迁移**: 自动迁移现有用户配置
- **数据格式**: 保持Chrome Storage数据格式兼容
- **降级支持**: 自动降级到V1.0 HTTP模式

## [1.0.0] - 2024-12-26

### 新增
- 🎉 首次发布Chrome扩展AI助手
- ✨ Chrome Manifest V3侧边栏扩展
- 🤖 集成DeepSeek AI模型
- 💬 实时聊天界面
- 📝 Markdown渲染支持
- 🎨 代码语法高亮
- ⚙️ 自定义API配置
- 🔧 文件操作工具集成
- 📚 自动生成API文档
- 🧪 完整的测试套件

### 技术特性
- **前端**: Chrome Extension Manifest V3
- **后端**: FastAPI + pydantic-ai
- **AI模型**: DeepSeek Chat API
- **渲染**: marked.js + highlight.js
- **样式**: 现代化CSS设计
- **测试**: pytest + 手动测试脚本

### 核心功能
- **智能对话**: 支持多轮对话，上下文理解
- **文件操作**: 在沙箱环境中进行文件管理
- **代码高亮**: 支持多种编程语言语法高亮
- **Markdown渲染**: 完整的Markdown格式支持
- **API配置**: 灵活的API端点和密钥配置
- **错误处理**: 完善的错误提示和恢复机制

### 安全特性
- 🔒 API密钥安全存储
- 🛡️ 输入验证和清理
- 🚧 沙箱文件操作
- 🔐 CORS安全配置
- 📊 请求速率限制

### 开发工具
- 📋 完整的开发者文档
- 🚀 自动化开发环境设置
- 📦 一键构建和打包脚本
- 🧪 自动化和手动测试
- 📈 性能基准测试

## [0.3.0] - 2024-12-25 (内部版本)

### 新增
- FastAPI后端服务
- pydantic-ai集成
- 文件操作工具函数
- API文档自动生成

### 修改
- 从Flask迁移到FastAPI
- 改进错误处理机制
- 优化异步处理

### 修复
- 解决事件循环冲突问题
- 修复CORS配置问题
- 改进依赖管理

## [0.2.0] - 2024-12-24 (内部版本)

### 新增
- 聊天界面基础功能
- Markdown渲染支持
- 代码语法高亮
- 设置模态框

### 修改
- 改进UI/UX设计
- 优化消息显示
- 增强响应式布局

## [0.1.0] - 2024-12-23 (内部版本)

### 新增
- 基础Chrome扩展结构
- Manifest V3配置
- 侧边栏基础界面
- 后台服务脚本

---

## 版本说明

### 版本号格式
本项目使用语义化版本号：`主版本号.次版本号.修订号`

- **主版本号**: 不兼容的API修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

### 更新类型说明

- **新增 (Added)**: 新功能
- **修改 (Changed)**: 对现有功能的修改
- **弃用 (Deprecated)**: 即将移除的功能
- **移除 (Removed)**: 已移除的功能
- **修复 (Fixed)**: 问题修复
- **安全 (Security)**: 安全相关的修复

### 发布周期

- **主版本**: 根据重大功能更新发布
- **次版本**: 每月发布，包含新功能和改进
- **修订版**: 根据需要发布，主要用于bug修复

### 兼容性承诺

- **主版本**: 可能包含破坏性更改
- **次版本**: 保证向下兼容
- **修订版**: 保证向下兼容

### 支持政策

- **当前版本**: 完全支持
- **前一个主版本**: 安全更新支持
- **更早版本**: 不再支持

---

## 贡献指南

如果您想为此项目做出贡献，请：

1. 查看 [DEVELOPER_GUIDE.md](DEVELOPER_GUIDE.md) 了解开发指南
2. 遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范
3. 确保所有测试通过
4. 更新相关文档

### 提交信息格式

```
<类型>[可选的作用域]: <描述>

[可选的正文]

[可选的脚注]
```

**类型**:
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式修改
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

**示例**:
```
feat(chat): 添加消息复制功能

允许用户复制AI回复的内容到剪贴板

Closes #123
```

---

*最后更新: 2024年12月26日*
