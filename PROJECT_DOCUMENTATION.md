# Chromeæ‰©å±•AIåŠ©æ‰‹ - å®Œæ•´é¡¹ç›®æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [å¼€å‘è®¾è®¡æ–‡æ¡£](#2-å¼€å‘è®¾è®¡æ–‡æ¡£)
3. [å®‰è£…å’Œé…ç½®æŒ‡å—](#3-å®‰è£…å’Œé…ç½®æŒ‡å—)
4. [ä½¿ç”¨æ–‡æ¡£](#4-ä½¿ç”¨æ–‡æ¡£)
5. [å¼€å‘æŒ‡å—](#5-å¼€å‘æŒ‡å—)
6. [éƒ¨ç½²å’Œç»´æŠ¤](#6-éƒ¨ç½²å’Œç»´æŠ¤)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®çš„å’ŒåŠŸèƒ½æè¿°

Chromeæ‰©å±•AIåŠ©æ‰‹æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æµè§ˆå™¨æ‰©å±•ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ä¾¿æ·çš„AIåŠ©æ‰‹æœåŠ¡ã€‚è¯¥é¡¹ç›®é›†æˆäº†ç°ä»£åŒ–çš„AIæ¨¡å‹ï¼Œæ”¯æŒæ™ºèƒ½å¯¹è¯ã€æ–‡ä»¶æ“ä½œã€Markdownæ¸²æŸ“å’Œä»£ç é«˜äº®ç­‰åŠŸèƒ½ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

**ğŸ¤– æ™ºèƒ½å¯¹è¯åŠŸèƒ½**
- é›†æˆDeepSeek AIæ¨¡å‹ï¼Œæ”¯æŒå¤šè½®æ™ºèƒ½å¯¹è¯
- å…¼å®¹OpenAI APIæ ¼å¼ï¼Œæ”¯æŒå¤šç§AIæ¨¡å‹åˆ‡æ¢
- å®æ—¶æµå¼å“åº”ï¼Œæä¾›æµç•…çš„å¯¹è¯ä½“éªŒ
- æ”¯æŒè‡ªå®šä¹‰APIç«¯ç‚¹å’Œæ¨¡å‹å‚æ•°é…ç½®

**ğŸ“ æ–‡ä»¶æ“ä½œèƒ½åŠ›**
- åœ¨å®‰å…¨æ²™ç®±ç¯å¢ƒä¸­è¿›è¡Œæ–‡ä»¶ç®¡ç†
- æ”¯æŒæ–‡ä»¶åˆ›å»ºã€è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤ç­‰åŸºæœ¬æ“ä½œ
- æä¾›ç›®å½•æµè§ˆã€æ–‡ä»¶æœç´¢ã€å†…å®¹æ›¿æ¢ç­‰é«˜çº§åŠŸèƒ½
- æ”¯æŒæ–‡ä»¶å¤‡ä»½ã€å½’æ¡£å‹ç¼©ã€è§£å‹ç­‰å®ç”¨å·¥å…·

**ğŸ“ å†…å®¹æ¸²æŸ“åŠŸèƒ½**
- å®Œæ•´æ”¯æŒMarkdownæ ¼å¼æ˜¾ç¤ºå’Œæ¸²æŸ“
- å¤šç§ç¼–ç¨‹è¯­è¨€è¯­æ³•é«˜äº®æ˜¾ç¤º
- ä»£ç å—å¤åˆ¶åŠŸèƒ½ï¼Œæå‡å¼€å‘æ•ˆç‡
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæš—è‰²ä¸»é¢˜

**âš™ï¸ çµæ´»é…ç½®ç³»ç»Ÿ**
- æ”¯æŒè‡ªå®šä¹‰APIç«¯ç‚¹é…ç½®
- APIå¯†é’¥å®‰å…¨å­˜å‚¨å’Œç®¡ç†
- æ¨¡å‹å‚æ•°ä¸ªæ€§åŒ–è®¾ç½®
- è¿æ¥æµ‹è¯•å’ŒéªŒè¯åŠŸèƒ½

### 1.2 æŠ€æœ¯æ ˆå’Œæ¶æ„æ¦‚è§ˆ

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **Chrome Extension API**: åŸºäºManifest V3æœ€æ–°æ ‡å‡†
- **JavaScript ES6+**: ç°ä»£åŒ–JavaScriptè¯­æ³•å’Œç‰¹æ€§
- **CSS3**: å“åº”å¼è®¾è®¡å’Œæš—è‰²ä¸»é¢˜æ”¯æŒ
- **marked.js**: é«˜æ€§èƒ½Markdownè§£æå’Œæ¸²æŸ“
- **highlight.js**: å¤šè¯­è¨€ä»£ç è¯­æ³•é«˜äº®

#### åç«¯æŠ€æœ¯æ ˆ
- **FastAPI**: ç°ä»£åŒ–Python Webæ¡†æ¶ï¼Œæä¾›é«˜æ€§èƒ½å¼‚æ­¥APIæœåŠ¡
- **pydantic-ai**: AIæ¨¡å‹é›†æˆå’Œå·¥å…·è°ƒç”¨æ¡†æ¶
- **uvicorn**: ASGIæœåŠ¡å™¨ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†
- **pydantic**: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- **python-dotenv**: ç¯å¢ƒå˜é‡ç®¡ç†

#### AIé›†æˆæŠ€æœ¯
- **DeepSeek API**: ä¸»è¦AIæ¨¡å‹æœåŠ¡æä¾›å•†
- **OpenAIå…¼å®¹API**: æ”¯æŒå¤šç§AIæ¨¡å‹æ¥å…¥
- **æµå¼å“åº”**: å®æ—¶å¯¹è¯ä½“éªŒä¼˜åŒ–
- **å·¥å…·è°ƒç”¨**: æ”¯æŒæ–‡ä»¶æ“ä½œç­‰æ‰©å±•åŠŸèƒ½

### 1.3 é¡¹ç›®ç»“æ„å’Œç›®å½•è¯´æ˜

```
chrome_plus/
â”œâ”€â”€ ğŸ“„ manifest.json              # Chromeæ‰©å±•é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ¨ sidepanel.html             # ä¾§è¾¹æ ä¸»ç•Œé¢HTML
â”œâ”€â”€ ğŸ’… sidepanel.css              # ä¾§è¾¹æ æ ·å¼æ–‡ä»¶
â”œâ”€â”€ âš™ï¸ background.js              # åå°æœåŠ¡è„šæœ¬
â”œâ”€â”€ ğŸ’¬ chat.js                    # èŠå¤©ç•Œé¢é€»è¾‘
â”œâ”€â”€ ğŸ”Œ api.js                     # APIé€šä¿¡å°è£…
â”œâ”€â”€ ğŸ–¼ï¸ images/                    # å›¾æ ‡èµ„æºç›®å½•
â”‚   â”œâ”€â”€ icon-16.png               # 16x16 å›¾æ ‡
â”‚   â”œâ”€â”€ icon-48.png               # 48x48 å›¾æ ‡
â”‚   â””â”€â”€ icon-128.png              # 128x128 å›¾æ ‡
â”œâ”€â”€ ğŸš€ scripts/                   # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ dev-setup.sh              # å¼€å‘ç¯å¢ƒè®¾ç½®è„šæœ¬
â”‚   â””â”€â”€ build-extension.sh        # æ‰©å±•æ‰“åŒ…è„šæœ¬
â”œâ”€â”€ ğŸ–¥ï¸ server/                    # åç«¯æœåŠ¡ç›®å½•
â”‚   â”œâ”€â”€ main.py                   # FastAPIä¸»åº”ç”¨
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ start_server.py           # æœåŠ¡å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ pyproject.toml            # Pythoné¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
â”‚   â”œâ”€â”€ uv.lock                   # ä¾èµ–é”å®šæ–‡ä»¶
â”‚   â”œâ”€â”€ test/                     # æ²™ç®±æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ test_fastapi.py           # è‡ªåŠ¨åŒ–æµ‹è¯•
â”‚   â””â”€â”€ test_manual.py            # æ‰‹åŠ¨æµ‹è¯•è„šæœ¬
â””â”€â”€ ğŸ“š docs/                      # é¡¹ç›®æ–‡æ¡£
    â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
    â”œâ”€â”€ ARCHITECTURE.md           # æ¶æ„è®¾è®¡æ–‡æ¡£
    â”œâ”€â”€ DEVELOPER_GUIDE.md        # å¼€å‘è€…æŒ‡å—
    â”œâ”€â”€ QUICK_START.md            # å¿«é€Ÿå¼€å§‹æŒ‡å—
    â””â”€â”€ CHANGELOG.md              # ç‰ˆæœ¬æ›´æ–°æ—¥å¿—
```

#### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

**å‰ç«¯æ ¸å¿ƒæ–‡ä»¶**
- `manifest.json`: Chromeæ‰©å±•çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰æƒé™ã€å…¥å£ç‚¹å’ŒåŸºæœ¬ä¿¡æ¯
- `sidepanel.html`: ä¾§è¾¹æ çš„ä¸»ç•Œé¢ï¼ŒåŒ…å«èŠå¤©ç•Œé¢å’Œè®¾ç½®æ¨¡æ€æ¡†
- `sidepanel.css`: æ ·å¼æ–‡ä»¶ï¼Œå®ç°å“åº”å¼è®¾è®¡å’Œæš—è‰²ä¸»é¢˜
- `background.js`: åå°æœåŠ¡è„šæœ¬ï¼Œå¤„ç†æ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
- `chat.js`: èŠå¤©ç•Œé¢çš„æ ¸å¿ƒé€»è¾‘ï¼Œå¤„ç†æ¶ˆæ¯æ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
- `api.js`: APIé€šä¿¡å°è£…ï¼Œæ”¯æŒå¤šç§APIç«¯ç‚¹é…ç½®

**åç«¯æ ¸å¿ƒæ–‡ä»¶**
- `main.py`: FastAPIä¸»åº”ç”¨ï¼ŒåŒ…å«æ‰€æœ‰APIç«¯ç‚¹å’Œä¸šåŠ¡é€»è¾‘
- `config.py`: é…ç½®ç®¡ç†æ¨¡å—ï¼Œå¤„ç†ç¯å¢ƒå˜é‡å’Œè®¾ç½®
- `start_server.py`: æœåŠ¡å¯åŠ¨è„šæœ¬ï¼Œé…ç½®æœåŠ¡å™¨å‚æ•°
- `pyproject.toml`: Pythoné¡¹ç›®é…ç½®ï¼Œå®šä¹‰ä¾èµ–å’Œé¡¹ç›®å…ƒæ•°æ®

**å·¥å…·å’Œè„šæœ¬**
- `scripts/dev-setup.sh`: è‡ªåŠ¨åŒ–å¼€å‘ç¯å¢ƒè®¾ç½®è„šæœ¬
- `scripts/build-extension.sh`: æ‰©å±•æ‰“åŒ…å’Œå‘å¸ƒè„šæœ¬
- `test_fastapi.py`: è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
- `test_manual.py`: æ‰‹åŠ¨æµ‹è¯•è„šæœ¬

### 1.4 å®‰å…¨ç‰¹æ€§

**ğŸ”’ æ•°æ®å®‰å…¨**
- APIå¯†é’¥é‡‡ç”¨Chromeå­˜å‚¨APIåŠ å¯†å­˜å‚¨
- æ‰€æœ‰æ–‡ä»¶æ“ä½œé™åˆ¶åœ¨å®‰å…¨æ²™ç®±ç›®å½•å†…
- è¾“å…¥éªŒè¯å’Œæ¸…ç†ï¼Œé˜²æ­¢æ¶æ„ä»£ç æ³¨å…¥
- ä¸¥æ ¼çš„CORSç­–ç•¥ï¼Œé™åˆ¶è·¨åŸŸè®¿é—®

**ğŸ›¡ï¸ æƒé™æ§åˆ¶**
- æœ€å°æƒé™åŸåˆ™ï¼Œä»…ç”³è¯·å¿…è¦çš„Chrome APIæƒé™
- æ–‡ä»¶æ“ä½œè·¯å¾„éªŒè¯ï¼Œé˜²æ­¢ç›®å½•éå†æ”»å‡»
- APIè®¿é—®æ§åˆ¶ï¼Œæ”¯æŒå¯†é’¥éªŒè¯å’Œé€Ÿç‡é™åˆ¶

**ğŸš§ æ²™ç®±éš”ç¦»**
- æ–‡ä»¶æ“ä½œä¸¥æ ¼é™åˆ¶åœ¨æŒ‡å®šçš„testç›®å½•å†…
- è·¯å¾„éªŒè¯æœºåˆ¶ï¼Œé˜²æ­¢è®¿é—®ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶
- é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### 1.5 æŠ€æœ¯äº®ç‚¹

**ç°ä»£åŒ–æ¶æ„**
- é‡‡ç”¨Chrome Manifest V3æœ€æ–°æ ‡å‡†
- FastAPIå¼‚æ­¥æ¡†æ¶ï¼Œæä¾›é«˜æ€§èƒ½APIæœåŠ¡
- æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤

**ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- æš—è‰²ä¸»é¢˜æ”¯æŒï¼Œå‡å°‘è§†è§‰ç–²åŠ³
- å®æ—¶æ¶ˆæ¯æ¸²æŸ“ï¼Œæµç•…çš„äº¤äº’ä½“éªŒ
- ä»£ç é«˜äº®å’Œå¤åˆ¶åŠŸèƒ½ï¼Œæå‡å¼€å‘æ•ˆç‡

**å¼€å‘å‹å¥½**
- å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–å’Œæ‰‹åŠ¨æµ‹è¯•
- è¯¦ç»†çš„APIæ–‡æ¡£ï¼Œæ”¯æŒSwagger UIå’ŒReDoc
- è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œç®€åŒ–å¼€å‘å’Œéƒ¨ç½²æµç¨‹
- ä¸°å¯Œçš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

---

## 2. å¼€å‘è®¾è®¡æ–‡æ¡£

### 2.1 ç³»ç»Ÿæ¶æ„è®¾è®¡å›¾

#### æ•´ä½“ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph "Chromeæµè§ˆå™¨ç¯å¢ƒ"
        A[Chromeæ‰©å±•å‰ç«¯]
        A1[sidepanel.html - ç”¨æˆ·ç•Œé¢]
        A2[background.js - åå°æœåŠ¡]
        A3[chat.js - èŠå¤©é€»è¾‘]
        A4[api.js - APIé€šä¿¡]
        A5[Chrome Storage API]
        
        A --> A1
        A --> A2
        A --> A3
        A --> A4
        A3 --> A5
        A4 --> A5
    end
    
    subgraph "æœ¬åœ°æœåŠ¡å™¨"
        B[FastAPIåç«¯æœåŠ¡]
        B1[main.py - ä¸»åº”ç”¨]
        B2[æ–‡ä»¶æ“ä½œå·¥å…·é›†]
        B3[pydantic-aié›†æˆ]
        B4[é…ç½®ç®¡ç†]
        B5[æ²™ç®±æ–‡ä»¶ç³»ç»Ÿ]
        
        B --> B1
        B1 --> B2
        B1 --> B3
        B1 --> B4
        B2 --> B5
    end
    
    subgraph "å¤–éƒ¨AIæœåŠ¡"
        C[AIæ¨¡å‹API]
        C1[DeepSeek API]
        C2[OpenAIå…¼å®¹API]
        C3[å…¶ä»–AIæœåŠ¡]
        
        C --> C1
        C --> C2
        C --> C3
    end
    
    A4 -->|HTTPè¯·æ±‚| B1
    B3 -->|APIè°ƒç”¨| C1
    C1 -->|æµå¼å“åº”| B3
    B1 -->|JSONå“åº”| A4
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#fff3e0
```

#### å‰ç«¯ç»„ä»¶æ¶æ„

```mermaid
graph LR
    subgraph "Chromeæ‰©å±•ç»„ä»¶"
        M[manifest.json] --> BG[background.js]
        M --> SP[sidepanel.html]
        
        SP --> CSS[sidepanel.css]
        SP --> CHAT[chat.js]
        SP --> API[api.js]
        
        CHAT --> RENDER[æ¶ˆæ¯æ¸²æŸ“]
        CHAT --> EVENT[äº‹ä»¶å¤„ç†]
        CHAT --> STORAGE[å­˜å‚¨ç®¡ç†]
        
        API --> HTTP[HTTPå®¢æˆ·ç«¯]
        API --> CONFIG[é…ç½®ç®¡ç†]
        API --> ERROR[é”™è¯¯å¤„ç†]
        
        BG --> LIFECYCLE[ç”Ÿå‘½å‘¨æœŸç®¡ç†]
        BG --> SIDEPANEL[ä¾§è¾¹æ æ§åˆ¶]
    end
    
    subgraph "å¤–éƒ¨ä¾èµ–"
        MARKED[marked.js]
        HIGHLIGHT[highlight.js]
        CHROME[Chrome APIs]
    end
    
    RENDER --> MARKED
    RENDER --> HIGHLIGHT
    STORAGE --> CHROME
    SIDEPANEL --> CHROME
    
    style M fill:#ffcdd2
    style SP fill:#c8e6c9
    style CHAT fill:#bbdefb
    style API fill:#f8bbd9
```

### 2.2 æ ¸å¿ƒæ¨¡å—å’Œç»„ä»¶è¯´æ˜

#### å‰ç«¯æ ¸å¿ƒæ¨¡å—

**1. æ¶ˆæ¯ç®¡ç†æ¨¡å— (chat.js)**
```javascript
class MessageManager {
    constructor() {
        this.chatBox = document.getElementById('chat-box');
        this.messageInput = document.getElementById('message-input');
        this.initializeEventListeners();
    }
    
    // æ¶ˆæ¯æ¸²æŸ“ï¼šæ”¯æŒMarkdownå’Œä»£ç é«˜äº®
    appendMessage(sender, message) {
        // Markdownæ¸²æŸ“é€»è¾‘
        // ä»£ç é«˜äº®å¤„ç†
        // å¤åˆ¶æŒ‰é’®æ·»åŠ 
    }
    
    // æ¶ˆæ¯å‘é€ï¼šéªŒè¯å’ŒAPIè°ƒç”¨
    async sendMessage() {
        // è¾“å…¥éªŒè¯
        // APIè°ƒç”¨
        // é”™è¯¯å¤„ç†
    }
}
```

**2. APIé€šä¿¡æ¨¡å— (api.js)**
```javascript
class APIClient {
    constructor() {
        this.baseURL = 'http://localhost:5001';
    }
    
    // æ”¯æŒå¤šç§APIé…ç½®
    async sendMessageToBackend(message) {
        // æ£€æŸ¥è‡ªå®šä¹‰é…ç½®
        // æ„å»ºè¯·æ±‚
        // å¤„ç†å“åº”
        // é”™è¯¯å¤„ç†
    }
}
```

**3. è®¾ç½®ç®¡ç†æ¨¡å—**
```javascript
class SettingsManager {
    // Chromeå­˜å‚¨APIé›†æˆ
    async loadSettings() {
        return new Promise((resolve) => {
            chrome.storage.sync.get(['apiEndpoint', 'apiKey', 'modelName'], resolve);
        });
    }
    
    // è®¾ç½®ä¿å­˜å’ŒéªŒè¯
    async saveSettings(settings) {
        // éªŒè¯è®¾ç½®
        // ä¿å­˜åˆ°Chromeå­˜å‚¨
        // è¿æ¥æµ‹è¯•
    }
}
```

#### åç«¯æ ¸å¿ƒæ¨¡å—

**1. FastAPIåº”ç”¨ä¸»æ¨¡å— (main.py)**
```python
# åº”ç”¨åˆå§‹åŒ–
app = FastAPI(
    title="ShellAI API",
    description="AIåŠ©æ‰‹APIï¼Œæ”¯æŒæ–‡ä»¶æ“ä½œå’ŒèŠå¤©åŠŸèƒ½",
    version="1.0.0"
)

# CORSä¸­é—´ä»¶é…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["chrome-extension://*", "http://localhost:*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ä¸»è¦APIç«¯ç‚¹
@app.post("/chat", response_model=ChatResponse)
async def chat(request: ChatRequest) -> ChatResponse:
    # æ¶ˆæ¯å¤„ç†é€»è¾‘
    # AIæ¨¡å‹è°ƒç”¨
    # å·¥å…·å‡½æ•°æ‰§è¡Œ
    # å“åº”è¿”å›
```

**2. æ–‡ä»¶æ“ä½œå·¥å…·é›†**
```python
# å®‰å…¨è·¯å¾„éªŒè¯
def _validate_path(target_path: Path, check_existence=False, expect_dir=False, expect_file=False):
    # è·¯å¾„å®‰å…¨æ£€æŸ¥
    # æ²™ç®±è¾¹ç•ŒéªŒè¯
    # æƒé™æ£€æŸ¥
    
# æ–‡ä»¶æ“ä½œå‡½æ•°
def read_file(name: str) -> str:
def write_file(name: str, content: str, mode: str = 'w') -> str:
def list_files(path: str = ".") -> list[str]:
def create_directory(name: str) -> str:
def delete_file(name: str) -> str:
# ... æ›´å¤šæ–‡ä»¶æ“ä½œå‡½æ•°
```

**3. AIæ¨¡å‹é›†æˆæ¨¡å—**
```python
# pydantic-ai Agenté…ç½®
agent = Agent(
    model=model,
    system_prompt=BASE_SYSTEM_PROMPT,
    tools=agent_tools
)

# å¼‚æ­¥æ¶ˆæ¯å¤„ç†
async def process_message(message: str):
    # çº¿ç¨‹æ± æ‰§è¡ŒåŒæ­¥ä»£ç 
    loop = asyncio.get_event_loop()
    with concurrent.futures.ThreadPoolExecutor() as executor:
        resp = await loop.run_in_executor(executor, run_agent_sync)
    return resp.output
```

### 2.3 æ•°æ®æµå’Œä¸šåŠ¡é€»è¾‘

#### ç”¨æˆ·äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant UI as Chromeæ‰©å±•UI
    participant API as APIå®¢æˆ·ç«¯
    participant Server as FastAPIæœåŠ¡
    participant AI as AIæ¨¡å‹
    participant FS as æ–‡ä»¶ç³»ç»Ÿ
    
    U->>UI: è¾“å…¥æ¶ˆæ¯
    UI->>UI: éªŒè¯è¾“å…¥
    UI->>API: å‘é€æ¶ˆæ¯
    
    alt ä½¿ç”¨è‡ªå®šä¹‰API
        API->>AI: ç›´æ¥è°ƒç”¨AI API
        AI->>API: è¿”å›å“åº”
    else ä½¿ç”¨é»˜è®¤åç«¯
        API->>Server: POST /chat
        Server->>Server: è§£æè¯·æ±‚
        Server->>AI: è°ƒç”¨AIæ¨¡å‹
        AI->>Server: è¿”å›AIå“åº”
        
        opt éœ€è¦æ–‡ä»¶æ“ä½œ
            Server->>FS: æ‰§è¡Œæ–‡ä»¶æ“ä½œ
            FS->>Server: è¿”å›æ“ä½œç»“æœ
        end
        
        Server->>API: è¿”å›JSONå“åº”
    end
    
    API->>UI: å¤„ç†å“åº”
    UI->>UI: æ¸²æŸ“Markdown
    UI->>U: æ˜¾ç¤ºç»“æœ
```

#### æ•°æ®å¤„ç†æµç¨‹

**1. æ¶ˆæ¯å¤„ç†ç®¡é“**
```
ç”¨æˆ·è¾“å…¥ â†’ è¾“å…¥éªŒè¯ â†’ æ¶ˆæ¯å‘é€ â†’ åç«¯å¤„ç† â†’ AIæ¨¡å‹è°ƒç”¨ â†’ å·¥å…·æ‰§è¡Œ â†’ å“åº”ç”Ÿæˆ â†’ å‰ç«¯æ¸²æŸ“ â†’ ç”¨æˆ·æ˜¾ç¤º
```

**2. æ–‡ä»¶æ“ä½œæµç¨‹**
```
AIæŒ‡ä»¤è§£æ â†’ è·¯å¾„éªŒè¯ â†’ æƒé™æ£€æŸ¥ â†’ æ–‡ä»¶æ“ä½œæ‰§è¡Œ â†’ ç»“æœè¿”å› â†’ çŠ¶æ€æ›´æ–°
```

**3. é…ç½®ç®¡ç†æµç¨‹**
```
ç”¨æˆ·è®¾ç½® â†’ è¾“å…¥éªŒè¯ â†’ Chromeå­˜å‚¨ â†’ é…ç½®åŠ è½½ â†’ APIè°ƒç”¨ â†’ è¿æ¥æµ‹è¯• â†’ çŠ¶æ€åé¦ˆ
```

### 2.4 APIæ¥å£è®¾è®¡

#### RESTful APIç«¯ç‚¹

**POST /chat**
- **åŠŸèƒ½**: å¤„ç†ç”¨æˆ·èŠå¤©æ¶ˆæ¯
- **è¯·æ±‚æ ¼å¼**:
```json
{
    "message": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹"
}
```
- **å“åº”æ ¼å¼**:
```json
{
    "response": "AIåŠ©æ‰‹å›å¤å†…å®¹"
}
```
- **é”™è¯¯å“åº”**:
```json
{
    "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

**GET /docs**
- **åŠŸèƒ½**: Swagger UI APIæ–‡æ¡£
- **å“åº”**: HTMLé¡µé¢

**GET /redoc**
- **åŠŸèƒ½**: ReDoc APIæ–‡æ¡£
- **å“åº”**: HTMLé¡µé¢

**GET /openapi.json**
- **åŠŸèƒ½**: OpenAPIè§„èŒƒæ–‡æ¡£
- **å“åº”**: JSONæ ¼å¼çš„APIè§„èŒƒ

#### æ•°æ®æ¨¡å‹å®šä¹‰

```python
class ChatRequest(BaseModel):
    """èŠå¤©è¯·æ±‚æ¨¡å‹"""
    message: str
    
    class Config:
        json_schema_extra = {
            "example": {
                "message": "ä½ å¥½ï¼Œè¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæ–‡ä»¶"
            }
        }

class ChatResponse(BaseModel):
    """èŠå¤©å“åº”æ¨¡å‹"""
    response: str
    
    class Config:
        json_schema_extra = {
            "example": {
                "response": "ä½ å¥½ï¼æˆ‘å¯ä»¥å¸®ä½ åˆ›å»ºæ–‡ä»¶ã€‚è¯·å‘Šè¯‰æˆ‘æ–‡ä»¶åå’Œå†…å®¹ã€‚"
            }
        }

class ErrorResponse(BaseModel):
    """é”™è¯¯å“åº”æ¨¡å‹"""
    error: str
    
    class Config:
        json_schema_extra = {
            "example": {
                "error": "è¯·æ±‚å¤„ç†å¤±è´¥"
            }
        }
```

### 2.5 æ•°æ®åº“è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨æ–‡ä»¶ç³»ç»Ÿä½œä¸ºä¸»è¦å­˜å‚¨æ–¹å¼ï¼Œä¸ä½¿ç”¨ä¼ ç»Ÿæ•°æ®åº“ã€‚æ•°æ®å­˜å‚¨ç­–ç•¥å¦‚ä¸‹ï¼š

#### å­˜å‚¨æ¶æ„

**1. Chromeæ‰©å±•å­˜å‚¨**
- ä½¿ç”¨Chrome Storage APIå­˜å‚¨ç”¨æˆ·é…ç½®
- æ•°æ®ç±»å‹ï¼šAPIç«¯ç‚¹ã€å¯†é’¥ã€æ¨¡å‹è®¾ç½®
- å­˜å‚¨ä½ç½®ï¼šæµè§ˆå™¨åŒæ­¥å­˜å‚¨

**2. æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨**
- æ²™ç®±ç›®å½•ï¼š`server/test/`
- ç”¨é€”ï¼šAIåŠ©æ‰‹æ–‡ä»¶æ“ä½œçš„å·¥ä½œç©ºé—´
- å®‰å…¨é™åˆ¶ï¼šè·¯å¾„éªŒè¯å’Œæƒé™æ§åˆ¶

**3. æ—¥å¿—å­˜å‚¨**
- åº”ç”¨æ—¥å¿—ï¼šç»“æ„åŒ–JSONæ ¼å¼
- äº¤äº’å†å²ï¼šMarkdownæ ¼å¼ï¼ˆå¯é€‰ï¼‰
- å­˜å‚¨ä½ç½®ï¼šæœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

#### æ•°æ®æµè½¬

```mermaid
graph LR
    subgraph "å‰ç«¯å­˜å‚¨"
        CS[Chrome Storage]
        CS --> |é…ç½®æ•°æ®| API[APIé…ç½®]
        CS --> |ç”¨æˆ·è®¾ç½®| UI[ç•Œé¢è®¾ç½®]
    end
    
    subgraph "åç«¯å­˜å‚¨"
        FS[æ–‡ä»¶ç³»ç»Ÿ]
        FS --> |å·¥ä½œæ–‡ä»¶| SANDBOX[æ²™ç®±ç›®å½•]
        FS --> |æ—¥å¿—æ–‡ä»¶| LOGS[æ—¥å¿—ç›®å½•]
        FS --> |é…ç½®æ–‡ä»¶| CONFIG[.envæ–‡ä»¶]
    end
    
    subgraph "ä¸´æ—¶å­˜å‚¨"
        MEM[å†…å­˜ç¼“å­˜]
        MEM --> |ä¼šè¯æ•°æ®| SESSION[ä¼šè¯çŠ¶æ€]
        MEM --> |å¤„ç†ç¼“å­˜| CACHE[å“åº”ç¼“å­˜]
    end
    
    API --> |HTTPè¯·æ±‚| FS
    LOGS --> |ç›‘æ§æ•°æ®| MEM
    CONFIG --> |ç¯å¢ƒå˜é‡| MEM
```

---

## 3. å®‰è£…å’Œé…ç½®æŒ‡å—

### 3.1 ç¯å¢ƒè¦æ±‚å’Œä¾èµ–

#### ç³»ç»Ÿè¦æ±‚

**æ“ä½œç³»ç»Ÿæ”¯æŒ**
- Windows 10/11 (x64)
- macOS 10.15+ (Intel/Apple Silicon)
- Linux (Ubuntu 18.04+, CentOS 7+, Debian 10+)

**æµè§ˆå™¨è¦æ±‚**
- Google Chrome 88+ (æ”¯æŒManifest V3)
- Microsoft Edge 88+ (Chromiumå†…æ ¸)
- å…¶ä»–Chromiumå†…æ ¸æµè§ˆå™¨

**ç¡¬ä»¶è¦æ±‚**
- CPU: åŒæ ¸2.0GHzä»¥ä¸Š
- å†…å­˜: 4GB RAMä»¥ä¸Š
- å­˜å‚¨: 500MBå¯ç”¨ç©ºé—´
- ç½‘ç»œ: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

#### å¿…éœ€è½¯ä»¶ä¾èµ–

**Pythonç¯å¢ƒ**
```bash
# Pythonç‰ˆæœ¬è¦æ±‚
Python 3.10+

# æ¨èä½¿ç”¨pyenvç®¡ç†Pythonç‰ˆæœ¬
curl https://pyenv.run | bash
pyenv install 3.10.12
pyenv global 3.10.12
```

**uvåŒ…ç®¡ç†å™¨**
```bash
# macOS/Linuxå®‰è£…
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windowså®‰è£… (PowerShell)
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# éªŒè¯å®‰è£…
uv --version
```

**Gitç‰ˆæœ¬æ§åˆ¶**
```bash
# Ubuntu/Debian
sudo apt update && sudo apt install git

# CentOS/RHEL
sudo yum install git

# macOS (ä½¿ç”¨Homebrew)
brew install git

# Windows
# ä¸‹è½½å¹¶å®‰è£… Git for Windows
```

#### å¯é€‰å·¥å…·æ¨è

**å¼€å‘å·¥å…·**
- **VS Code**: æ¨èçš„ä»£ç ç¼–è¾‘å™¨
- **Chrome DevTools**: æ‰©å±•è°ƒè¯•å·¥å…·
- **Postman**: APIæµ‹è¯•å·¥å…·
- **curl**: å‘½ä»¤è¡ŒHTTPå®¢æˆ·ç«¯

**ç›‘æ§å·¥å…·**
- **htop**: ç³»ç»Ÿèµ„æºç›‘æ§
- **jq**: JSONæ•°æ®å¤„ç†
- **tree**: ç›®å½•ç»“æ„æ˜¾ç¤º

### 3.2 å®‰è£…æ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šè‡ªåŠ¨åŒ–å®‰è£…ï¼ˆæ¨èï¼‰

**1. å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-username/chrome_plus.git
cd chrome_plus
```

**2. è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬**
```bash
chmod +x scripts/dev-setup.sh
./scripts/dev-setup.sh
```

**3. é…ç½®APIå¯†é’¥**
```bash
# ç¼–è¾‘ç¯å¢ƒå˜é‡æ–‡ä»¶
nano server/.env

# æ·»åŠ ä»¥ä¸‹å†…å®¹
DEEPSEEK_API_KEY=sk-your-actual-api-key-here
TAVILY_API_KEY=tvly-your-tavily-key-here  # å¯é€‰
```

**4. å¯åŠ¨å¼€å‘ç¯å¢ƒ**
```bash
./start-dev.sh
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

**1. å…‹éš†å’Œå‡†å¤‡**
```bash
git clone https://github.com/your-username/chrome_plus.git
cd chrome_plus
```

**2. å®‰è£…åç«¯ä¾èµ–**
```bash
cd server
uv sync
```

**3. åˆ›å»ºé…ç½®æ–‡ä»¶**
```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

**4. éªŒè¯å®‰è£…**
```bash
# è¿è¡Œæµ‹è¯•
uv run python -m pytest test_fastapi.py -v

# å¯åŠ¨æœåŠ¡å™¨
uv run python start_server.py
```

**5. å®‰è£…Chromeæ‰©å±•**
```bash
# æ‰“å¼€Chromeæµè§ˆå™¨
# è®¿é—® chrome://extensions/
# å¼€å¯å¼€å‘è€…æ¨¡å¼
# ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
# é€‰æ‹©é¡¹ç›®æ ¹ç›®å½•
```

### 3.3 é…ç½®æ–‡ä»¶è¯´æ˜

#### ç¯å¢ƒå˜é‡é…ç½® (.env)

```bash
# ===========================================
# APIé…ç½® - å¿…éœ€è®¾ç½®
# ===========================================

# DeepSeek APIå¯†é’¥ (å¿…éœ€)
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Tavilyæœç´¢APIå¯†é’¥ (å¯é€‰ï¼Œç”¨äºç½‘ç»œæœç´¢åŠŸèƒ½)
TAVILY_API_KEY=tvly-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ===========================================
# æœåŠ¡å™¨é…ç½®
# ===========================================

# æœåŠ¡å™¨ç›‘å¬åœ°å€
SERVER_HOST=127.0.0.1

# æœåŠ¡å™¨ç«¯å£
SERVER_PORT=5001

# è°ƒè¯•æ¨¡å¼ (å¼€å‘ç¯å¢ƒè®¾ä¸ºtrueï¼Œç”Ÿäº§ç¯å¢ƒè®¾ä¸ºfalse)
DEBUG=true

# ===========================================
# æ—¥å¿—é…ç½®
# ===========================================

# æ—¥å¿—çº§åˆ« (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# æ—¥å¿—æ–‡ä»¶è·¯å¾„
LOG_FILE=logs/app.log

# æ˜¯å¦å¯ç”¨ç»“æ„åŒ–æ—¥å¿—
STRUCTURED_LOGGING=true

# ===========================================
# å®‰å…¨é…ç½®
# ===========================================

# æœ€å¤§æ¶ˆæ¯é•¿åº¦é™åˆ¶
MAX_MESSAGE_LENGTH=10000

# é€Ÿç‡é™åˆ¶ (æ¯åˆ†é’Ÿè¯·æ±‚æ•°)
RATE_LIMIT_PER_MINUTE=60

# å…è®¸çš„CORSæº
CORS_ORIGINS=chrome-extension://*,http://localhost:*

# ===========================================
# AIæ¨¡å‹é…ç½®
# ===========================================

# é»˜è®¤AIæ¨¡å‹
DEFAULT_MODEL=deepseek-chat

# APIè¶…æ—¶æ—¶é—´ (ç§’)
API_TIMEOUT=30

# æœ€å¤§é‡è¯•æ¬¡æ•°
MAX_RETRIES=3
```

#### Chromeæ‰©å±•é…ç½® (manifest.json)

```json
{
  "manifest_version": 3,
  "name": "AIåŠ©æ‰‹ Plus",
  "version": "1.0.0",
  "description": "æ™ºèƒ½AIåŠ©æ‰‹Chromeæ‰©å±•ï¼Œæ”¯æŒå¤šç§AIæ¨¡å‹ï¼Œæä¾›ä¾¿æ·çš„ä¾§è¾¹æ èŠå¤©ç•Œé¢ã€‚",

  "icons": {
    "16": "images/icon-16.png",
    "48": "images/icon-48.png",
    "128": "images/icon-128.png"
  },

  "permissions": [
    "sidePanel",    // ä¾§è¾¹æ API
    "storage"       // å­˜å‚¨API
  ],

  "host_permissions": [
    "http://localhost:5001/*"  // æœ¬åœ°APIè®¿é—®æƒé™
  ],

  "side_panel": {
    "default_path": "sidepanel.html"
  },

  "action": {
    "default_title": "æ‰“å¼€AIåŠ©æ‰‹"
  },

  "background": {
    "service_worker": "background.js"
  }
}
```

#### Pythoné¡¹ç›®é…ç½® (pyproject.toml)

```toml
[project]
name = "chrome-plus-server"
version = "1.0.0"
description = "Chromeæ‰©å±•AIåŠ©æ‰‹åç«¯æœåŠ¡"
readme = "README.md"
requires-python = ">=3.10"

dependencies = [
    "fastapi>=0.104.0,<0.116.0",
    "uvicorn>=0.34.0",
    "pydantic>=2.11.0",
    "pydantic-ai[tavily]>=0.3.3",
    "python-dotenv>=1.1.0",
    "psutil>=5.9.0",
    "aiohttp>=3.11.0",
    "httpx>=0.28.0",
    "pytest>=8.4.0"
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]

[tool.black]
line-length = 88
target-version = ['py310']

[tool.isort]
profile = "black"
line_length = 88
```

### 3.4 ç¯å¢ƒå˜é‡è®¾ç½®

#### APIå¯†é’¥è·å–

**DeepSeek APIå¯†é’¥**
1. è®¿é—® [DeepSeekå®˜ç½‘](https://platform.deepseek.com/)
2. æ³¨å†Œè´¦å·å¹¶ç™»å½•
3. è¿›å…¥APIç®¡ç†é¡µé¢
4. åˆ›å»ºæ–°çš„APIå¯†é’¥
5. å¤åˆ¶å¯†é’¥åˆ°`.env`æ–‡ä»¶

**Tavily APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰**
1. è®¿é—® [Tavilyå®˜ç½‘](https://tavily.com/)
2. æ³¨å†Œè´¦å·å¹¶ç™»å½•
3. è·å–APIå¯†é’¥
4. æ·»åŠ åˆ°`.env`æ–‡ä»¶

#### ç¯å¢ƒå˜é‡éªŒè¯

**éªŒè¯è„šæœ¬**
```bash
#!/bin/bash
# scripts/verify-env.sh

echo "ğŸ” éªŒè¯ç¯å¢ƒé…ç½®..."

# æ£€æŸ¥Pythonç‰ˆæœ¬
python_version=$(python3 -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")
echo "Pythonç‰ˆæœ¬: $python_version"

# æ£€æŸ¥uvå®‰è£…
if command -v uv >/dev/null 2>&1; then
    echo "âœ… uvå·²å®‰è£…: $(uv --version)"
else
    echo "âŒ uvæœªå®‰è£…"
    exit 1
fi

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cd server
if [ -f .env ]; then
    echo "âœ… æ‰¾åˆ°.envæ–‡ä»¶"

    # æ£€æŸ¥å¿…éœ€çš„ç¯å¢ƒå˜é‡
    source .env

    if [ -n "$DEEPSEEK_API_KEY" ]; then
        echo "âœ… DEEPSEEK_API_KEYå·²è®¾ç½®"
    else
        echo "âš ï¸  DEEPSEEK_API_KEYæœªè®¾ç½®"
    fi

    if [ -n "$TAVILY_API_KEY" ]; then
        echo "âœ… TAVILY_API_KEYå·²è®¾ç½®"
    else
        echo "â„¹ï¸  TAVILY_API_KEYæœªè®¾ç½®ï¼ˆå¯é€‰ï¼‰"
    fi
else
    echo "âŒ æœªæ‰¾åˆ°.envæ–‡ä»¶"
    exit 1
fi

# æµ‹è¯•ä¾èµ–å®‰è£…
echo "ğŸ§ª æµ‹è¯•ä¾èµ–å®‰è£…..."
if uv run python -c "import fastapi, pydantic, uvicorn; print('ä¾èµ–æ£€æŸ¥é€šè¿‡')"; then
    echo "âœ… æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…"
else
    echo "âŒ ä¾èµ–å®‰è£…æœ‰é—®é¢˜"
    exit 1
fi

echo "ğŸ‰ ç¯å¢ƒé…ç½®éªŒè¯å®Œæˆï¼"
```

#### é…ç½®æœ€ä½³å®è·µ

**å®‰å…¨é…ç½®**
```bash
# è®¾ç½®.envæ–‡ä»¶æƒé™
chmod 600 server/.env

# æ·»åŠ åˆ°.gitignore
echo "server/.env" >> .gitignore
echo "server/.env.local" >> .gitignore
```

**å¼€å‘ç¯å¢ƒé…ç½®**
```bash
# å¼€å‘ç¯å¢ƒå˜é‡
export CHROME_PLUS_ENV=development
export DEBUG=true
export LOG_LEVEL=DEBUG

# ç”Ÿäº§ç¯å¢ƒå˜é‡
export CHROME_PLUS_ENV=production
export DEBUG=false
export LOG_LEVEL=INFO
```

**é…ç½®éªŒè¯å‘½ä»¤**
```bash
# éªŒè¯é…ç½®
./scripts/verify-env.sh

# æµ‹è¯•APIè¿æ¥
curl -X POST "http://127.0.0.1:5001/chat" \
  -H "Content-Type: application/json" \
  -d '{"message": "é…ç½®æµ‹è¯•"}'

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl -f http://127.0.0.1:5001/docs || echo "æœåŠ¡æœªå¯åŠ¨"
```

## 4. ä½¿ç”¨æ–‡æ¡£

### 4.1 åŠŸèƒ½ä½¿ç”¨è¯´æ˜

#### åŸºç¡€èŠå¤©åŠŸèƒ½

**å¯åŠ¨AIåŠ©æ‰‹**
1. ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
2. ç‚¹å‡»Chromeå·¥å…·æ ä¸­çš„AIåŠ©æ‰‹å›¾æ ‡
3. ä¾§è¾¹æ å°†è‡ªåŠ¨æ‰“å¼€ï¼Œæ˜¾ç¤ºæ¬¢è¿ç•Œé¢

**å‘é€æ¶ˆæ¯**
```
æ–¹æ³•ä¸€ï¼šè¾“å…¥æ¡†è¾“å…¥ + ç‚¹å‡»å‘é€æŒ‰é’®
æ–¹æ³•äºŒï¼šè¾“å…¥æ¡†è¾“å…¥ + æŒ‰Enteré”®
æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å¿«æ·é”® Ctrl+Enterï¼ˆå¿«é€Ÿå‘é€ï¼‰
```

**æ¶ˆæ¯ç±»å‹æ”¯æŒ**
- æ™®é€šæ–‡æœ¬å¯¹è¯
- ä»£ç ç›¸å…³é—®é¢˜
- æ–‡ä»¶æ“ä½œæŒ‡ä»¤
- æŠ€æœ¯é—®é¢˜å’¨è¯¢
- åˆ›æ„å†™ä½œååŠ©

#### æ–‡ä»¶æ“ä½œåŠŸèƒ½

**åˆ›å»ºæ–‡ä»¶**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"è¯·åˆ›å»ºä¸€ä¸ªåä¸ºhello.pyçš„æ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ‰“å°Hello World"
"åˆ›å»ºä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼ŒåŒ…å«é¡¹ç›®ä»‹ç»"
"æ–°å»ºä¸€ä¸ªconfig.jsoné…ç½®æ–‡ä»¶"
```

**è¯»å–æ–‡ä»¶**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"è¯·è¯»å–hello.pyæ–‡ä»¶çš„å†…å®¹"
"æ˜¾ç¤ºREADME.mdçš„å†…å®¹"
"æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"
```

**ä¿®æ”¹æ–‡ä»¶**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"åœ¨hello.pyæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°å‡½æ•°"
"ä¿®æ”¹config.jsonä¸­çš„ç«¯å£é…ç½®"
"æ›¿æ¢README.mdä¸­çš„é¡¹ç›®åç§°"
```

**æ–‡ä»¶ç®¡ç†**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"åˆ—å‡ºå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶"
"åˆ›å»ºä¸€ä¸ªåä¸ºdocsçš„ç›®å½•"
"åˆ é™¤ä¸´æ—¶æ–‡ä»¶temp.txt"
"å¤‡ä»½é‡è¦æ–‡ä»¶important.py"
```

#### é«˜çº§åŠŸèƒ½

**ä»£ç åˆ†æå’Œç”Ÿæˆ**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"åˆ†æè¿™æ®µPythonä»£ç çš„æ€§èƒ½é—®é¢˜"
"ç”Ÿæˆä¸€ä¸ªFastAPIçš„CRUDæ¥å£"
"ä¼˜åŒ–è¿™ä¸ªSQLæŸ¥è¯¢è¯­å¥"
"è§£é‡Šè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„å«ä¹‰"
```

**æ–‡æ¡£ç”Ÿæˆ**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"ä¸ºè¿™ä¸ªå‡½æ•°ç”Ÿæˆæ–‡æ¡£æ³¨é‡Š"
"åˆ›å»ºAPIæ¥å£æ–‡æ¡£"
"ç”Ÿæˆé¡¹ç›®çš„READMEæ–‡ä»¶"
"å†™ä¸€ä¸ªå®‰è£…æŒ‡å—"
```

**é—®é¢˜è¯Šæ–­**
```
ç¤ºä¾‹æŒ‡ä»¤ï¼š
"è¿™ä¸ªé”™è¯¯ä¿¡æ¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"
"å¦‚ä½•è§£å†³Pythonå¯¼å…¥æ¨¡å—çš„é—®é¢˜ï¼Ÿ"
"Chromeæ‰©å±•æ— æ³•åŠ è½½æ€ä¹ˆåŠï¼Ÿ"
"APIè¯·æ±‚å¤±è´¥çš„å¯èƒ½åŸå› "
```

### 4.2 æ“ä½œæµç¨‹å’Œç¤ºä¾‹

#### å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

**åœºæ™¯ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„Webé¡¹ç›®**

**æ­¥éª¤1ï¼šé¡¹ç›®åˆå§‹åŒ–**
```
ç”¨æˆ·è¾“å…¥ï¼š
"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªç®€å•çš„Webé¡¹ç›®ç»“æ„ï¼ŒåŒ…å«HTMLã€CSSå’ŒJavaScriptæ–‡ä»¶"

AIåŠ©æ‰‹å›å¤ï¼š
æˆ‘æ¥å¸®ä½ åˆ›å»ºä¸€ä¸ªç®€å•çš„Webé¡¹ç›®ç»“æ„ã€‚

[æ‰§è¡Œæ–‡ä»¶æ“ä½œ]
âœ… åˆ›å»ºç›®å½• 'web-project'
âœ… åˆ›å»ºæ–‡ä»¶ 'web-project/index.html'
âœ… åˆ›å»ºæ–‡ä»¶ 'web-project/style.css'
âœ… åˆ›å»ºæ–‡ä»¶ 'web-project/script.js'

é¡¹ç›®ç»“æ„å·²åˆ›å»ºå®Œæˆï¼š
web-project/
â”œâ”€â”€ index.html
â”œâ”€â”€ style.css
â””â”€â”€ script.js
```

**æ­¥éª¤2ï¼šæ·»åŠ å†…å®¹**
```
ç”¨æˆ·è¾“å…¥ï¼š
"åœ¨index.htmlä¸­æ·»åŠ ä¸€ä¸ªç®€å•çš„é¡µé¢ç»“æ„"

AIåŠ©æ‰‹å›å¤ï¼š
æˆ‘æ¥ä¸ºä½ æ·»åŠ HTMLé¡µé¢ç»“æ„ã€‚

[æ‰§è¡Œæ–‡ä»¶æ“ä½œ]
âœ… æ›´æ–°æ–‡ä»¶ 'web-project/index.html'

å·²æ·»åŠ åŒ…å«ä»¥ä¸‹å†…å®¹çš„HTMLç»“æ„ï¼š
- æ ‡å‡†çš„HTML5æ–‡æ¡£ç»“æ„
- å“åº”å¼metaæ ‡ç­¾
- é“¾æ¥åˆ°CSSå’ŒJavaScriptæ–‡ä»¶
- åŸºæœ¬çš„é¡µé¢å†…å®¹åŒºåŸŸ
```

**æ­¥éª¤3ï¼šæ ·å¼è®¾è®¡**
```
ç”¨æˆ·è¾“å…¥ï¼š
"ä¸ºé¡µé¢æ·»åŠ ä¸€äº›åŸºç¡€çš„CSSæ ·å¼"

AIåŠ©æ‰‹å›å¤ï¼š
æˆ‘æ¥æ·»åŠ åŸºç¡€çš„CSSæ ·å¼ã€‚

[æ‰§è¡Œæ–‡ä»¶æ“ä½œ]
âœ… æ›´æ–°æ–‡ä»¶ 'web-project/style.css'

å·²æ·»åŠ çš„æ ·å¼åŒ…æ‹¬ï¼š
- é¡µé¢é‡ç½®æ ·å¼
- å“åº”å¼å¸ƒå±€
- ç°ä»£åŒ–çš„é¢œè‰²æ–¹æ¡ˆ
- åŸºç¡€çš„ç»„ä»¶æ ·å¼
```

#### é…ç½®ç®¡ç†æµç¨‹

**è‡ªå®šä¹‰APIé…ç½®**

**æ­¥éª¤1ï¼šæ‰“å¼€è®¾ç½®**
1. ç‚¹å‡»AIåŠ©æ‰‹ç•Œé¢å³ä¸Šè§’çš„è®¾ç½®æŒ‰é’® âš™ï¸
2. è®¾ç½®æ¨¡æ€æ¡†å°†æ‰“å¼€

**æ­¥éª¤2ï¼šé…ç½®APIç«¯ç‚¹**
```
APIç«¯ç‚¹ç¤ºä¾‹ï¼š
- OpenAI: https://api.openai.com
- DeepSeek: https://api.deepseek.com
- è‡ªå®šä¹‰: https://your-api.example.com
```

**æ­¥éª¤3ï¼šè®¾ç½®APIå¯†é’¥**
```
å¯†é’¥æ ¼å¼ç¤ºä¾‹ï¼š
- OpenAI: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
- DeepSeek: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**æ­¥éª¤4ï¼šé€‰æ‹©æ¨¡å‹**
```
å¸¸ç”¨æ¨¡å‹ï¼š
- gpt-3.5-turbo
- gpt-4
- deepseek-chat
- claude-3-sonnet
```

**æ­¥éª¤5ï¼šæµ‹è¯•è¿æ¥**
1. ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
2. ç³»ç»Ÿå°†å‘é€æµ‹è¯•è¯·æ±‚éªŒè¯é…ç½®
3. æ˜¾ç¤ºè¿æ¥ç»“æœå’ŒçŠ¶æ€ä¿¡æ¯

**æ­¥éª¤6ï¼šä¿å­˜è®¾ç½®**
1. ç¡®è®¤é…ç½®æ— è¯¯åç‚¹å‡»"ä¿å­˜è®¾ç½®"
2. è®¾ç½®å°†ä¿å­˜åˆ°Chromeå­˜å‚¨ä¸­
3. åç»­å¯¹è¯å°†ä½¿ç”¨æ–°çš„é…ç½®

### 4.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### å®‰è£…å’Œé…ç½®é—®é¢˜

**Q1: Chromeæ‰©å±•æ— æ³•åŠ è½½**
```
é—®é¢˜ç°è±¡ï¼š
- æ‰©å±•åœ¨chrome://extensions/é¡µé¢æ˜¾ç¤ºé”™è¯¯
- ç‚¹å‡»æ‰©å±•å›¾æ ‡æ²¡æœ‰ååº”
- ä¾§è¾¹æ æ— æ³•æ‰“å¼€

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥manifest.jsonè¯­æ³•æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤Chromeç‰ˆæœ¬æ”¯æŒManifest V3 (88+)
3. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹Chromeæ‰©å±•é”™è¯¯æ—¥å¿—
5. é‡æ–°åŠ è½½æ‰©å±•

éªŒè¯å‘½ä»¤ï¼š
# æ£€æŸ¥manifest.jsonè¯­æ³•
cat manifest.json | jq .

# éªŒè¯æ–‡ä»¶å­˜åœ¨
ls -la sidepanel.html background.js
```

**Q2: åç«¯æœåŠ¡å¯åŠ¨å¤±è´¥**
```
é—®é¢˜ç°è±¡ï¼š
- è¿è¡Œstart_server.pyæŠ¥é”™
- ç«¯å£5001è¢«å ç”¨
- ä¾èµ–åŒ…å¯¼å…¥å¤±è´¥

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥Pythonç‰ˆæœ¬ >= 3.10
2. éªŒè¯ä¾èµ–å®‰è£…å®Œæ•´æ€§
3. æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
4. ç¡®è®¤ç¯å¢ƒå˜é‡è®¾ç½®

éªŒè¯å‘½ä»¤ï¼š
# æ£€æŸ¥Pythonç‰ˆæœ¬
python3 --version

# æ£€æŸ¥ä¾èµ–
uv run python -c "import fastapi, pydantic, uvicorn"

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5001

# æµ‹è¯•æœåŠ¡å¯åŠ¨
cd server && uv run python start_server.py
```

**Q3: APIå¯†é’¥é…ç½®é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
- APIè°ƒç”¨è¿”å›401é”™è¯¯
- æç¤ºå¯†é’¥æ— æ•ˆ
- è¿æ¥æµ‹è¯•å¤±è´¥

è§£å†³æ–¹æ¡ˆï¼š
1. ç¡®è®¤APIå¯†é’¥æ ¼å¼æ­£ç¡®
2. æ£€æŸ¥å¯†é’¥æ˜¯å¦è¿‡æœŸ
3. éªŒè¯APIç«¯ç‚¹URL
4. ç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³

éªŒè¯å‘½ä»¤ï¼š
# æµ‹è¯•APIå¯†é’¥
curl -X POST "https://api.deepseek.com/v1/chat/completions" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-chat","messages":[{"role":"user","content":"test"}]}'
```

#### ä½¿ç”¨è¿‡ç¨‹é—®é¢˜

**Q4: æ¶ˆæ¯å‘é€å¤±è´¥**
```
é—®é¢˜ç°è±¡ï¼š
- ç‚¹å‡»å‘é€æŒ‰é’®æ— ååº”
- æ˜¾ç¤ºç½‘ç»œé”™è¯¯
- å“åº”è¶…æ—¶

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤åç«¯æœåŠ¡è¿è¡ŒçŠ¶æ€
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
4. éªŒè¯CORSé…ç½®

è°ƒè¯•æ­¥éª¤ï¼š
1. æ‰“å¼€Chrome DevTools (F12)
2. æŸ¥çœ‹Consoleæ ‡ç­¾é¡µçš„é”™è¯¯ä¿¡æ¯
3. æ£€æŸ¥Networkæ ‡ç­¾é¡µçš„è¯·æ±‚çŠ¶æ€
4. éªŒè¯APIç«¯ç‚¹å¯è®¿é—®æ€§
```

**Q5: Markdownæ¸²æŸ“å¼‚å¸¸**
```
é—®é¢˜ç°è±¡ï¼š
- ä»£ç å—æ˜¾ç¤ºä¸æ­£ç¡®
- æ ¼å¼åŒ–å¤±æ•ˆ
- ç‰¹æ®Šå­—ç¬¦æ˜¾ç¤ºå¼‚å¸¸

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥marked.jsåº“åŠ è½½
2. éªŒè¯highlight.jsé…ç½®
3. ç¡®è®¤CSSæ ·å¼æ­£ç¡®
4. æ£€æŸ¥å†…å®¹ç¼–ç 

è°ƒè¯•æ–¹æ³•ï¼š
# åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
console.log(typeof marked);
console.log(typeof hljs);
```

**Q6: æ–‡ä»¶æ“ä½œæƒé™é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
- æ— æ³•åˆ›å»ºæ–‡ä»¶
- è·¯å¾„è®¿é—®è¢«æ‹’ç»
- æ–‡ä»¶æ“ä½œå¤±è´¥

è§£å†³æ–¹æ¡ˆï¼š
1. ç¡®è®¤æ“ä½œåœ¨æ²™ç®±ç›®å½•å†…
2. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ ¼å¼
3. éªŒè¯ç›®å½•æƒé™
4. ç¡®è®¤ç£ç›˜ç©ºé—´å……è¶³

éªŒè¯å‘½ä»¤ï¼š
# æ£€æŸ¥æ²™ç®±ç›®å½•
ls -la server/test/

# æ£€æŸ¥æƒé™
ls -ld server/test/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

#### æ€§èƒ½ä¼˜åŒ–é—®é¢˜

**Q7: å“åº”é€Ÿåº¦æ…¢**
```
é—®é¢˜ç°è±¡ï¼š
- AIå›å¤å»¶è¿Ÿè¾ƒé•¿
- ç•Œé¢å¡é¡¿
- å†…å­˜å ç”¨è¿‡é«˜

ä¼˜åŒ–æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
2. ä¼˜åŒ–æ¶ˆæ¯é•¿åº¦
3. æ¸…ç†æµè§ˆå™¨ç¼“å­˜
4. é‡å¯åç«¯æœåŠ¡

ç›‘æ§å‘½ä»¤ï¼š
# æ£€æŸ¥æœåŠ¡å™¨èµ„æº
top -p $(pgrep -f "python.*start_server")

# æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping api.deepseek.com

# ç›‘æ§å†…å­˜ä½¿ç”¨
ps aux | grep python
```

**Q8: å†…å­˜æ³„æ¼é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
- é•¿æ—¶é—´ä½¿ç”¨åå˜æ…¢
- æµè§ˆå™¨å†…å­˜å ç”¨å¢åŠ 
- ç³»ç»Ÿå“åº”è¿Ÿç¼“

è§£å†³æ–¹æ¡ˆï¼š
1. å®šæœŸæ¸…ç†èŠå¤©å†å²
2. é‡æ–°åŠ è½½æ‰©å±•
3. é‡å¯æµè§ˆå™¨
4. æ£€æŸ¥ä»£ç ä¸­çš„å†…å­˜æ³„æ¼

é¢„é˜²æªæ–½ï¼š
- é™åˆ¶èŠå¤©å†å²é•¿åº¦
- åŠæ—¶æ¸…ç†DOMå…ƒç´ 
- ä½¿ç”¨å¼±å¼•ç”¨é¿å…å¾ªç¯å¼•ç”¨
- å®šæœŸç›‘æ§å†…å­˜ä½¿ç”¨
```

## 5. å¼€å‘æŒ‡å—

### 5.1 ä»£ç ç»“æ„å’Œè§„èŒƒ

#### å‰ç«¯ä»£ç è§„èŒƒ

**JavaScriptä»£ç é£æ ¼**
```javascript
// ä½¿ç”¨ES6+è¯­æ³•
class MessageManager {
    constructor() {
        this.chatBox = document.getElementById('chat-box');
        this.messageInput = document.getElementById('message-input');
        this.initializeEventListeners();
    }

    // ä½¿ç”¨async/awaitå¤„ç†å¼‚æ­¥æ“ä½œ
    async sendMessage() {
        try {
            const message = this.validateInput();
            const response = await this.apiClient.post('/chat', {message});
            this.renderResponse(response);
        } catch (error) {
            this.handleError(error);
        }
    }

    // ä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®šthis
    initializeEventListeners() {
        this.sendButton.addEventListener('click', () => this.sendMessage());
        this.messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.sendMessage();
        });
    }
}

// å¸¸é‡ä½¿ç”¨å¤§å†™å‘½å
const API_BASE_URL = 'http://localhost:5001';
const MAX_MESSAGE_LENGTH = 10000;

// ä½¿ç”¨æ¨¡å—åŒ–å¯¼å‡º
export { MessageManager, API_BASE_URL };
```

**CSSä»£ç è§„èŒƒ**
```css
/* ä½¿ç”¨BEMå‘½åè§„èŒƒ */
.chat-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.chat-container__header {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.chat-container__messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
}

/* ä½¿ç”¨CSSå˜é‡ */
:root {
    --primary-color: #007bff;
    --secondary-color: #6c757d;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --border-color: #dee2e6;
    --border-radius: 0.375rem;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .chat-container {
        font-size: 0.875rem;
    }
}
```

**HTMLç»“æ„è§„èŒƒ**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ‰‹</title>
    <!-- å¤–éƒ¨ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- æœ¬åœ°æ ·å¼ -->
    <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
    <!-- è¯­ä¹‰åŒ–HTMLç»“æ„ -->
    <main id="chat-container" class="chat-container">
        <header class="chat-container__header">
            <h1>AIåŠ©æ‰‹</h1>
            <nav class="header-buttons">
                <button id="settings-button" type="button" aria-label="è®¾ç½®">âš™ï¸</button>
            </nav>
        </header>

        <section id="chat-box" class="chat-container__messages" role="log" aria-live="polite">
            <!-- æ¶ˆæ¯å†…å®¹ -->
        </section>

        <footer class="chat-container__input">
            <form id="message-form" class="input-form">
                <input type="text" id="message-input" placeholder="è¾“å…¥ä½ çš„æ¶ˆæ¯..." required>
                <button type="submit" id="send-button">å‘é€</button>
            </form>
        </footer>
    </main>

    <!-- æœ¬åœ°è„šæœ¬ -->
    <script src="api.js"></script>
    <script src="chat.js"></script>
</body>
</html>
```

#### åç«¯ä»£ç è§„èŒƒ

**Pythonä»£ç é£æ ¼**
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Chromeæ‰©å±•AIåŠ©æ‰‹åç«¯æœåŠ¡

æä¾›AIèŠå¤©å’Œæ–‡ä»¶æ“ä½œåŠŸèƒ½çš„FastAPIæœåŠ¡ã€‚
"""

import os
import asyncio
from pathlib import Path
from typing import Optional, List, Dict, Any
from datetime import datetime

from fastapi import FastAPI, HTTPException, Depends
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel, Field, validator
import uvicorn

# å¸¸é‡å®šä¹‰
API_VERSION = "1.0.0"
MAX_MESSAGE_LENGTH = 10000
DEFAULT_PORT = 5001

class ChatRequest(BaseModel):
    """èŠå¤©è¯·æ±‚æ¨¡å‹"""
    message: str = Field(..., min_length=1, max_length=MAX_MESSAGE_LENGTH)

    @validator('message')
    def validate_message(cls, v: str) -> str:
        """éªŒè¯æ¶ˆæ¯å†…å®¹"""
        if not v.strip():
            raise ValueError('æ¶ˆæ¯ä¸èƒ½ä¸ºç©º')
        return v.strip()

class ChatResponse(BaseModel):
    """èŠå¤©å“åº”æ¨¡å‹"""
    response: str
    timestamp: datetime = Field(default_factory=datetime.now)

# åº”ç”¨åˆå§‹åŒ–
app = FastAPI(
    title="Chromeæ‰©å±•AIåŠ©æ‰‹API",
    description="æä¾›AIèŠå¤©å’Œæ–‡ä»¶æ“ä½œåŠŸèƒ½",
    version=API_VERSION,
    docs_url="/docs",
    redoc_url="/redoc"
)

# ä¸­é—´ä»¶é…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["chrome-extension://*", "http://localhost:*"],
    allow_credentials=True,
    allow_methods=["GET", "POST"],
    allow_headers=["*"],
)

@app.post("/chat", response_model=ChatResponse)
async def chat_endpoint(request: ChatRequest) -> ChatResponse:
    """
    å¤„ç†èŠå¤©è¯·æ±‚

    Args:
        request: èŠå¤©è¯·æ±‚å¯¹è±¡

    Returns:
        ChatResponse: èŠå¤©å“åº”å¯¹è±¡

    Raises:
        HTTPException: è¯·æ±‚å¤„ç†å¤±è´¥æ—¶æŠ›å‡º
    """
    try:
        # å¤„ç†æ¶ˆæ¯é€»è¾‘
        response_text = await process_message(request.message)
        return ChatResponse(response=response_text)
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

async def process_message(message: str) -> str:
    """
    å¤„ç†ç”¨æˆ·æ¶ˆæ¯

    Args:
        message: ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯

    Returns:
        str: AIåŠ©æ‰‹çš„å›å¤
    """
    # å®ç°æ¶ˆæ¯å¤„ç†é€»è¾‘
    pass

if __name__ == "__main__":
    uvicorn.run(
        app,
        host="127.0.0.1",
        port=DEFAULT_PORT,
        log_level="info"
    )
```

**æ–‡æ¡£å­—ç¬¦ä¸²è§„èŒƒ**
```python
def validate_path(target_path: Path, check_existence: bool = False) -> tuple[bool, str]:
    """
    éªŒè¯æ–‡ä»¶è·¯å¾„çš„å®‰å…¨æ€§

    Args:
        target_path: è¦éªŒè¯çš„è·¯å¾„å¯¹è±¡
        check_existence: æ˜¯å¦æ£€æŸ¥è·¯å¾„å­˜åœ¨æ€§

    Returns:
        tuple[bool, str]: (æ˜¯å¦æœ‰æ•ˆ, é”™è¯¯ä¿¡æ¯)

    Raises:
        ValueError: è·¯å¾„æ ¼å¼æ— æ•ˆæ—¶æŠ›å‡º

    Examples:
        >>> validate_path(Path("test.txt"))
        (True, "")

        >>> validate_path(Path("../etc/passwd"))
        (False, "è·¯å¾„è¶…å‡ºå…è®¸èŒƒå›´")
    """
    pass
```

### 5.2 å¼€å‘ç¯å¢ƒæ­å»º

#### IDEé…ç½®

**VS Codeé…ç½®**
```json
// .vscode/settings.json
{
    "python.defaultInterpreterPath": "./server/.venv/bin/python",
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "python.sortImports.args": ["--profile", "black"],

    "javascript.preferences.quoteStyle": "single",
    "typescript.preferences.quoteStyle": "single",

    "files.associations": {
        "*.js": "javascript",
        "*.json": "jsonc"
    },

    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.organizeImports": true
    },

    "emmet.includeLanguages": {
        "javascript": "javascriptreact"
    }
}
```

**æ¨èæ‰©å±•**
```json
// .vscode/extensions.json
{
    "recommendations": [
        "ms-python.python",
        "ms-python.black-formatter",
        "ms-python.isort",
        "ms-python.pylint",
        "bradlc.vscode-tailwindcss",
        "esbenp.prettier-vscode",
        "ms-vscode.vscode-json",
        "redhat.vscode-yaml",
        "ms-vscode.chrome-debug"
    ]
}
```

#### å¼€å‘å·¥å…·é…ç½®

**Gité…ç½®**
```bash
# é…ç½®Gité’©å­
cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash
# è¿è¡Œä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥

echo "ğŸ” è¿è¡Œä»£ç æ£€æŸ¥..."

# Pythonä»£ç æ£€æŸ¥
cd server
if ! uv run black --check .; then
    echo "âŒ Pythonä»£ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·è¿è¡Œ: uv run black ."
    exit 1
fi

if ! uv run isort --check-only .; then
    echo "âŒ Pythonå¯¼å…¥æ’åºä¸ç¬¦åˆè§„èŒƒï¼Œè¯·è¿è¡Œ: uv run isort ."
    exit 1
fi

# JavaScriptä»£ç æ£€æŸ¥
cd ..
if command -v prettier >/dev/null 2>&1; then
    if ! prettier --check "*.js" "*.css" "*.html"; then
        echo "âŒ å‰ç«¯ä»£ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·è¿è¡Œ: prettier --write ."
        exit 1
    fi
fi

echo "âœ… ä»£ç æ£€æŸ¥é€šè¿‡"
EOF

chmod +x .git/hooks/pre-commit
```

**ä»£ç æ ¼å¼åŒ–é…ç½®**
```toml
# pyproject.toml
[tool.black]
line-length = 88
target-version = ['py310']
include = '\.pyi?$'
extend-exclude = '''
/(
  # directories
  \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | build
  | dist
)/
'''

[tool.isort]
profile = "black"
multi_line_output = 3
line_length = 88
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true

[tool.pylint.messages_control]
disable = "C0330, C0326"

[tool.pylint.format]
max-line-length = "88"
```

```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

### 5.3 è°ƒè¯•å’Œæµ‹è¯•æ–¹æ³•

#### å‰ç«¯è°ƒè¯•

**Chromeæ‰©å±•è°ƒè¯•**
```javascript
// è°ƒè¯•å·¥å…·å‡½æ•°
const DEBUG = true;

function debugLog(message, data = null) {
    if (DEBUG) {
        console.log(`[AIåŠ©æ‰‹] ${message}`, data);
    }
}

function debugError(message, error = null) {
    if (DEBUG) {
        console.error(`[AIåŠ©æ‰‹é”™è¯¯] ${message}`, error);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
class MessageManager {
    async sendMessage() {
        debugLog('å¼€å§‹å‘é€æ¶ˆæ¯');

        try {
            const response = await this.apiClient.post('/chat', {message});
            debugLog('æ”¶åˆ°å“åº”', response);
        } catch (error) {
            debugError('å‘é€æ¶ˆæ¯å¤±è´¥', error);
        }
    }
}
```

**æµè§ˆå™¨è°ƒè¯•æŠ€å·§**
```javascript
// 1. æ£€æŸ¥æ‰©å±•çŠ¶æ€
chrome.management.getSelf((info) => {
    console.log('æ‰©å±•ä¿¡æ¯:', info);
});

// 2. ç›‘æ§å­˜å‚¨å˜åŒ–
chrome.storage.onChanged.addListener((changes, namespace) => {
    console.log('å­˜å‚¨å˜åŒ–:', changes, namespace);
});

// 3. ç½‘ç»œè¯·æ±‚ç›‘æ§
const originalFetch = window.fetch;
window.fetch = function(...args) {
    console.log('Fetchè¯·æ±‚:', args);
    return originalFetch.apply(this, args)
        .then(response => {
            console.log('Fetchå“åº”:', response);
            return response;
        });
};

// 4. æ€§èƒ½ç›‘æ§
function measurePerformance(name, fn) {
    return async function(...args) {
        const start = performance.now();
        const result = await fn.apply(this, args);
        const end = performance.now();
        console.log(`${name} æ‰§è¡Œæ—¶é—´: ${end - start}ms`);
        return result;
    };
}
```

#### åç«¯è°ƒè¯•

**FastAPIè°ƒè¯•é…ç½®**
```python
import logging
from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
import time

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/debug.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

app = FastAPI(debug=True)

# è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
@app.middleware("http")
async def log_requests(request: Request, call_next):
    start_time = time.time()

    # è®°å½•è¯·æ±‚
    logger.info(f"è¯·æ±‚å¼€å§‹: {request.method} {request.url}")
    logger.debug(f"è¯·æ±‚å¤´: {dict(request.headers)}")

    response = await call_next(request)

    # è®°å½•å“åº”
    process_time = time.time() - start_time
    logger.info(f"è¯·æ±‚å®Œæˆ: {response.status_code} - {process_time:.2f}s")

    return response

# å¼‚å¸¸å¤„ç†
@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    logger.error(f"æœªå¤„ç†çš„å¼‚å¸¸: {exc}", exc_info=True)
    return {"error": "å†…éƒ¨æœåŠ¡å™¨é”™è¯¯"}
```

**è°ƒè¯•å·¥å…·å‡½æ•°**
```python
import functools
import time
from typing import Any, Callable

def debug_timer(func: Callable) -> Callable:
    """è£…é¥°å™¨ï¼šæµ‹é‡å‡½æ•°æ‰§è¡Œæ—¶é—´"""
    @functools.wraps(func)
    async def wrapper(*args, **kwargs) -> Any:
        start = time.time()
        try:
            result = await func(*args, **kwargs)
            return result
        finally:
            end = time.time()
            logger.debug(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {end - start:.2f}s")
    return wrapper

def debug_params(func: Callable) -> Callable:
    """è£…é¥°å™¨ï¼šè®°å½•å‡½æ•°å‚æ•°å’Œè¿”å›å€¼"""
    @functools.wraps(func)
    async def wrapper(*args, **kwargs) -> Any:
        logger.debug(f"{func.__name__} è°ƒç”¨å‚æ•°: args={args}, kwargs={kwargs}")
        result = await func(*args, **kwargs)
        logger.debug(f"{func.__name__} è¿”å›å€¼: {result}")
        return result
    return wrapper

# ä½¿ç”¨ç¤ºä¾‹
@debug_timer
@debug_params
async def process_message(message: str) -> str:
    # å¤„ç†é€»è¾‘
    return "å¤„ç†ç»“æœ"
```

#### è‡ªåŠ¨åŒ–æµ‹è¯•

**å‰ç«¯æµ‹è¯•**
```javascript
// test/frontend.test.js
describe('AIåŠ©æ‰‹å‰ç«¯æµ‹è¯•', () => {
    let messageManager;

    beforeEach(() => {
        // è®¾ç½®æµ‹è¯•ç¯å¢ƒ
        document.body.innerHTML = `
            <div id="chat-box"></div>
            <input id="message-input" />
            <button id="send-button">å‘é€</button>
        `;
        messageManager = new MessageManager();
    });

    test('æ¶ˆæ¯å‘é€åŠŸèƒ½', async () => {
        // æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
        const input = document.getElementById('message-input');
        input.value = 'æµ‹è¯•æ¶ˆæ¯';

        // æ¨¡æ‹ŸAPIå“åº”
        jest.spyOn(messageManager.apiClient, 'post')
            .mockResolvedValue({response: 'æµ‹è¯•å›å¤'});

        // æ‰§è¡Œå‘é€
        await messageManager.sendMessage();

        // éªŒè¯ç»“æœ
        const messages = document.querySelectorAll('.message');
        expect(messages).toHaveLength(2); // ç”¨æˆ·æ¶ˆæ¯ + AIå›å¤
    });

    test('è¾“å…¥éªŒè¯', () => {
        expect(() => messageManager.validateInput('')).toThrow('æ¶ˆæ¯ä¸èƒ½ä¸ºç©º');
        expect(() => messageManager.validateInput('a'.repeat(10001))).toThrow('æ¶ˆæ¯è¿‡é•¿');
    });
});
```

**åç«¯æµ‹è¯•**
```python
# test_api.py
import pytest
from fastapi.testclient import TestClient
from main import app

client = TestClient(app)

class TestChatAPI:
    """èŠå¤©APIæµ‹è¯•"""

    def test_chat_endpoint_success(self):
        """æµ‹è¯•æˆåŠŸçš„èŠå¤©è¯·æ±‚"""
        response = client.post("/chat", json={"message": "ä½ å¥½"})
        assert response.status_code == 200

        data = response.json()
        assert "response" in data
        assert isinstance(data["response"], str)
        assert len(data["response"]) > 0

    def test_chat_endpoint_empty_message(self):
        """æµ‹è¯•ç©ºæ¶ˆæ¯è¯·æ±‚"""
        response = client.post("/chat", json={"message": ""})
        assert response.status_code == 400

    def test_chat_endpoint_long_message(self):
        """æµ‹è¯•è¿‡é•¿æ¶ˆæ¯è¯·æ±‚"""
        long_message = "a" * 10001
        response = client.post("/chat", json={"message": long_message})
        assert response.status_code == 422

    @pytest.mark.asyncio
    async def test_file_operations(self):
        """æµ‹è¯•æ–‡ä»¶æ“ä½œåŠŸèƒ½"""
        # æµ‹è¯•æ–‡ä»¶åˆ›å»º
        response = client.post("/chat", json={
            "message": "åˆ›å»ºä¸€ä¸ªåä¸ºtest.txtçš„æ–‡ä»¶ï¼Œå†…å®¹æ˜¯Hello World"
        })
        assert response.status_code == 200

        # éªŒè¯æ–‡ä»¶æ˜¯å¦åˆ›å»º
        from pathlib import Path
        test_file = Path("server/test/test.txt")
        assert test_file.exists()
        assert test_file.read_text() == "Hello World"

        # æ¸…ç†æµ‹è¯•æ–‡ä»¶
        test_file.unlink()

# æ€§èƒ½æµ‹è¯•
class TestPerformance:
    """æ€§èƒ½æµ‹è¯•"""

    def test_response_time(self):
        """æµ‹è¯•å“åº”æ—¶é—´"""
        import time

        start = time.time()
        response = client.post("/chat", json={"message": "ç®€å•æµ‹è¯•"})
        end = time.time()

        assert response.status_code == 200
        assert (end - start) < 5.0  # å“åº”æ—¶é—´åº”å°äº5ç§’

    def test_concurrent_requests(self):
        """æµ‹è¯•å¹¶å‘è¯·æ±‚"""
        import concurrent.futures
        import threading

        def make_request():
            return client.post("/chat", json={"message": f"å¹¶å‘æµ‹è¯• {threading.current_thread().ident}"})

        with concurrent.futures.ThreadPoolExecutor(max_workers=10) as executor:
            futures = [executor.submit(make_request) for _ in range(10)]
            results = [future.result() for future in futures]

        # æ‰€æœ‰è¯·æ±‚éƒ½åº”è¯¥æˆåŠŸ
        for result in results:
            assert result.status_code == 200
```

**æµ‹è¯•è¿è¡Œè„šæœ¬**
```bash
#!/bin/bash
# scripts/run-tests.sh

echo "ğŸ§ª è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶..."

# åç«¯æµ‹è¯•
echo "ğŸ“‹ è¿è¡Œåç«¯æµ‹è¯•..."
cd server
uv run python -m pytest test_fastapi.py -v --cov=main --cov-report=html

# å‰ç«¯æµ‹è¯•ï¼ˆå¦‚æœé…ç½®äº†Jestï¼‰
echo "ğŸŒ è¿è¡Œå‰ç«¯æµ‹è¯•..."
cd ..
if command -v npm >/dev/null 2>&1; then
    npm test
fi

# é›†æˆæµ‹è¯•
echo "ğŸ”— è¿è¡Œé›†æˆæµ‹è¯•..."
cd server
uv run python test_manual.py

# æ€§èƒ½æµ‹è¯•
echo "âš¡ è¿è¡Œæ€§èƒ½æµ‹è¯•..."
uv run python scripts/benchmark.py

echo "âœ… æµ‹è¯•å®Œæˆï¼"
```

### 5.4 è´¡çŒ®æŒ‡å—

#### è´¡çŒ®æµç¨‹

**1. å‡†å¤‡å·¥ä½œ**
```bash
# Forké¡¹ç›®åˆ°ä¸ªäººè´¦æˆ·
# å…‹éš†Forkçš„ä»“åº“
git clone https://github.com/YOUR_USERNAME/chrome_plus.git
cd chrome_plus

# æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/ORIGINAL_OWNER/chrome_plus.git

# åˆ›å»ºå¼€å‘åˆ†æ”¯
git checkout -b feature/your-feature-name
```

**2. å¼€å‘è§„èŒƒ**
```bash
# éµå¾ªæäº¤ä¿¡æ¯è§„èŒƒ (Conventional Commits)
git commit -m "feat: æ·»åŠ æ–°çš„AIæ¨¡å‹æ”¯æŒ"
git commit -m "fix: ä¿®å¤æ¶ˆæ¯æ¸²æŸ“é—®é¢˜"
git commit -m "docs: æ›´æ–°APIæ–‡æ¡£"
git commit -m "test: æ·»åŠ æ–‡ä»¶æ“ä½œæµ‹è¯•"
git commit -m "refactor: é‡æ„æ¶ˆæ¯å¤„ç†é€»è¾‘"

# æäº¤ç±»å‹è¯´æ˜ï¼š
# feat: æ–°åŠŸèƒ½
# fix: ä¿®å¤bug
# docs: æ–‡æ¡£æ›´æ–°
# style: ä»£ç æ ¼å¼è°ƒæ•´
# refactor: ä»£ç é‡æ„
# test: æµ‹è¯•ç›¸å…³
# chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
```

**3. ä»£ç å®¡æŸ¥æ¸…å•**
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•
- [ ] æ²¡æœ‰å¼•å…¥æ–°çš„å®‰å…¨é—®é¢˜
- [ ] æ€§èƒ½æ²¡æœ‰æ˜æ˜¾ä¸‹é™

**4. æäº¤Pull Request**
```markdown
## å˜æ›´æè¿°
ç®€è¦æè¿°æœ¬æ¬¡å˜æ›´çš„å†…å®¹å’Œç›®çš„ã€‚

## å˜æ›´ç±»å‹
- [ ] æ–°åŠŸèƒ½
- [ ] Bugä¿®å¤
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ä»£ç é‡æ„

## æµ‹è¯•
- [ ] æ·»åŠ äº†æ–°çš„æµ‹è¯•
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•é€šè¿‡

## æ£€æŸ¥æ¸…å•
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æ²¡æœ‰ç ´åç°æœ‰åŠŸèƒ½
```

#### å¼€å‘æœ€ä½³å®è·µ

**ä»£ç è´¨é‡**
```python
# 1. ä½¿ç”¨ç±»å‹æ³¨è§£
def process_message(message: str, max_length: int = 1000) -> str:
    """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""
    if len(message) > max_length:
        raise ValueError(f"æ¶ˆæ¯é•¿åº¦ä¸èƒ½è¶…è¿‡{max_length}å­—ç¬¦")
    return message.strip()

# 2. å¼‚å¸¸å¤„ç†
try:
    result = await api_call()
except APIError as e:
    logger.error(f"APIè°ƒç”¨å¤±è´¥: {e}")
    raise HTTPException(status_code=500, detail="æœåŠ¡æš‚æ—¶ä¸å¯ç”¨")
except Exception as e:
    logger.exception("æœªçŸ¥é”™è¯¯")
    raise

# 3. èµ„æºç®¡ç†
async with aiohttp.ClientSession() as session:
    async with session.post(url, json=data) as response:
        return await response.json()
```

**å®‰å…¨è€ƒè™‘**
```python
# 1. è¾“å…¥éªŒè¯
def validate_file_path(path: str) -> Path:
    """éªŒè¯æ–‡ä»¶è·¯å¾„å®‰å…¨æ€§"""
    clean_path = Path(path).resolve()
    if not str(clean_path).startswith(str(SAFE_DIR)):
        raise ValueError("è·¯å¾„ä¸å®‰å…¨")
    return clean_path

# 2. æ•æ„Ÿä¿¡æ¯å¤„ç†
def log_request(request_data: dict) -> None:
    """è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œéšè—æ•æ„Ÿä¿¡æ¯"""
    safe_data = request_data.copy()
    if 'api_key' in safe_data:
        safe_data['api_key'] = '***'
    logger.info(f"è¯·æ±‚æ•°æ®: {safe_data}")

# 3. é€Ÿç‡é™åˆ¶
from functools import wraps
import time

def rate_limit(max_calls: int, time_window: int):
    def decorator(func):
        calls = []

        @wraps(func)
        async def wrapper(*args, **kwargs):
            now = time.time()
            calls[:] = [call_time for call_time in calls if now - call_time < time_window]

            if len(calls) >= max_calls:
                raise HTTPException(status_code=429, detail="è¯·æ±‚è¿‡äºé¢‘ç¹")

            calls.append(now)
            return await func(*args, **kwargs)
        return wrapper
    return decorator
```

---

## 6. éƒ¨ç½²å’Œç»´æŠ¤

### 6.1 éƒ¨ç½²æµç¨‹

#### å¼€å‘ç¯å¢ƒéƒ¨ç½²

**å¿«é€Ÿéƒ¨ç½²è„šæœ¬**
```bash
#!/bin/bash
# scripts/deploy-dev.sh

set -e

echo "ğŸš€ éƒ¨ç½²å¼€å‘ç¯å¢ƒ..."

# æ£€æŸ¥ä¾èµ–
command -v python3 >/dev/null 2>&1 || { echo "éœ€è¦Python 3.10+"; exit 1; }
command -v uv >/dev/null 2>&1 || { echo "éœ€è¦å®‰è£…uv"; exit 1; }

# å®‰è£…åç«¯ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
cd server
uv sync

# æ£€æŸ¥é…ç½®
if [ ! -f .env ]; then
    echo "âš ï¸  åˆ›å»ºé…ç½®æ–‡ä»¶..."
    cat > .env << EOF
DEEPSEEK_API_KEY=your_api_key_here
SERVER_HOST=127.0.0.1
SERVER_PORT=5001
DEBUG=true
LOG_LEVEL=DEBUG
EOF
    echo "è¯·ç¼–è¾‘ server/.env æ–‡ä»¶æ·»åŠ çœŸå®çš„APIå¯†é’¥"
fi

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p test logs

# è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
uv run python -m pytest test_fastapi.py -v

# å¯åŠ¨æœåŠ¡
echo "ğŸ”¥ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
uv run python start_server.py &
SERVER_PID=$!

echo "âœ… å¼€å‘ç¯å¢ƒéƒ¨ç½²å®Œæˆ!"
echo "ğŸ“– APIæ–‡æ¡£: http://127.0.0.1:5001/docs"
echo "ğŸ›‘ åœæ­¢æœåŠ¡: kill $SERVER_PID"
```

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**Dockeréƒ¨ç½²**
```dockerfile
# Dockerfile
FROM python:3.10-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    curl \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£…uv
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.cargo/bin:$PATH"

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY server/ .

# å®‰è£…Pythonä¾èµ–
RUN uv sync --frozen

# åˆ›å»ºérootç”¨æˆ·
RUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app
USER appuser

# åˆ›å»ºå¿…è¦ç›®å½•
RUN mkdir -p test logs

# æš´éœ²ç«¯å£
EXPOSE 5001

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:5001/docs || exit 1

# å¯åŠ¨å‘½ä»¤
CMD ["uv", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "5001"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  chrome-plus-api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5001:5001"
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - TAVILY_API_KEY=${TAVILY_API_KEY}
      - DEBUG=false
      - LOG_LEVEL=INFO
    volumes:
      - ./server/test:/app/test
      - ./server/logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/docs"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - chrome-plus-api
    restart: unless-stopped
```

**Nginxé…ç½®**
```nginx
# nginx.conf
events {
    worker_connections 1024;
}

http {
    upstream chrome_plus_api {
        server chrome-plus-api:5001;
    }

    server {
        listen 80;
        server_name your-domain.com;

        # é‡å®šå‘åˆ°HTTPS
        return 301 https://$server_name$request_uri;
    }

    server {
        listen 443 ssl http2;
        server_name your-domain.com;

        ssl_certificate /etc/nginx/ssl/cert.pem;
        ssl_certificate_key /etc/nginx/ssl/key.pem;

        # å®‰å…¨å¤´
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        location / {
            proxy_pass http://chrome_plus_api;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # CORSé…ç½®
            add_header Access-Control-Allow-Origin "chrome-extension://*";
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
            add_header Access-Control-Allow-Headers "Content-Type, Authorization";
        }
    }
}
```

#### äº‘å¹³å°éƒ¨ç½²

**AWSéƒ¨ç½²**
```yaml
# aws-deploy.yml
AWSTemplateFormatVersion: '2010-09-09'
Description: 'Chromeæ‰©å±•AIåŠ©æ‰‹éƒ¨ç½²'

Parameters:
  DeepSeekAPIKey:
    Type: String
    NoEcho: true
    Description: DeepSeek APIå¯†é’¥

Resources:
  ECSCluster:
    Type: AWS::ECS::Cluster
    Properties:
      ClusterName: chrome-plus-cluster

  TaskDefinition:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: chrome-plus-task
      NetworkMode: awsvpc
      RequiresCompatibilities:
        - FARGATE
      Cpu: 256
      Memory: 512
      ExecutionRoleArn: !Ref ExecutionRole
      ContainerDefinitions:
        - Name: chrome-plus-api
          Image: your-account.dkr.ecr.region.amazonaws.com/chrome-plus:latest
          PortMappings:
            - ContainerPort: 5001
          Environment:
            - Name: DEEPSEEK_API_KEY
              Value: !Ref DeepSeekAPIKey
            - Name: DEBUG
              Value: false
          LogConfiguration:
            LogDriver: awslogs
            Options:
              awslogs-group: !Ref LogGroup
              awslogs-region: !Ref AWS::Region
              awslogs-stream-prefix: ecs

  Service:
    Type: AWS::ECS::Service
    Properties:
      Cluster: !Ref ECSCluster
      TaskDefinition: !Ref TaskDefinition
      DesiredCount: 2
      LaunchType: FARGATE
      NetworkConfiguration:
        AwsvpcConfiguration:
          SecurityGroups:
            - !Ref SecurityGroup
          Subnets:
            - !Ref PrivateSubnet1
            - !Ref PrivateSubnet2
      LoadBalancers:
        - ContainerName: chrome-plus-api
          ContainerPort: 5001
          TargetGroupArn: !Ref TargetGroup
```

### 6.2 ç›‘æ§å’Œæ—¥å¿—

#### æ—¥å¿—é…ç½®

**ç»“æ„åŒ–æ—¥å¿—**
```python
# logging_config.py
import logging
import json
from datetime import datetime
from typing import Any, Dict

class JSONFormatter(logging.Formatter):
    """JSONæ ¼å¼æ—¥å¿—æ ¼å¼åŒ–å™¨"""

    def format(self, record: logging.LogRecord) -> str:
        log_entry = {
            'timestamp': datetime.utcnow().isoformat(),
            'level': record.levelname,
            'logger': record.name,
            'message': record.getMessage(),
            'module': record.module,
            'function': record.funcName,
            'line': record.lineno
        }

        # æ·»åŠ å¼‚å¸¸ä¿¡æ¯
        if record.exc_info:
            log_entry['exception'] = self.formatException(record.exc_info)

        # æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
        if hasattr(record, 'user_id'):
            log_entry['user_id'] = record.user_id
        if hasattr(record, 'request_id'):
            log_entry['request_id'] = record.request_id

        return json.dumps(log_entry, ensure_ascii=False)

def setup_logging(log_level: str = "INFO", log_file: str = "logs/app.log"):
    """é…ç½®æ—¥å¿—ç³»ç»Ÿ"""

    # åˆ›å»ºæ—¥å¿—ç›®å½•
    import os
    os.makedirs(os.path.dirname(log_file), exist_ok=True)

    # é…ç½®æ ¹æ—¥å¿—å™¨
    root_logger = logging.getLogger()
    root_logger.setLevel(getattr(logging, log_level.upper()))

    # æ–‡ä»¶å¤„ç†å™¨ - JSONæ ¼å¼
    file_handler = logging.FileHandler(log_file, encoding='utf-8')
    file_handler.setFormatter(JSONFormatter())
    root_logger.addHandler(file_handler)

    # æ§åˆ¶å°å¤„ç†å™¨ - ç®€å•æ ¼å¼
    console_handler = logging.StreamHandler()
    console_formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    console_handler.setFormatter(console_formatter)
    root_logger.addHandler(console_handler)

    return root_logger
```

**åº”ç”¨æ—¥å¿—é›†æˆ**
```python
# main.py
import logging
from fastapi import FastAPI, Request
import uuid
import time

logger = logging.getLogger(__name__)

@app.middleware("http")
async def logging_middleware(request: Request, call_next):
    """è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶"""
    request_id = str(uuid.uuid4())
    start_time = time.time()

    # è®°å½•è¯·æ±‚å¼€å§‹
    logger.info(
        "è¯·æ±‚å¼€å§‹",
        extra={
            'request_id': request_id,
            'method': request.method,
            'url': str(request.url),
            'client_ip': request.client.host
        }
    )

    response = await call_next(request)

    # è®°å½•è¯·æ±‚å®Œæˆ
    process_time = time.time() - start_time
    logger.info(
        "è¯·æ±‚å®Œæˆ",
        extra={
            'request_id': request_id,
            'status_code': response.status_code,
            'process_time': process_time
        }
    )

    return response
```

#### ç›‘æ§æŒ‡æ ‡

**æ€§èƒ½ç›‘æ§**
```python
# monitoring.py
import psutil
import time
from typing import Dict, Any
from dataclasses import dataclass

@dataclass
class SystemMetrics:
    """ç³»ç»ŸæŒ‡æ ‡"""
    cpu_percent: float
    memory_percent: float
    disk_usage: float
    network_io: Dict[str, int]
    timestamp: float

class MetricsCollector:
    """æŒ‡æ ‡æ”¶é›†å™¨"""

    def __init__(self):
        self.start_time = time.time()
        self.request_count = 0
        self.error_count = 0
        self.response_times = []

    def collect_system_metrics(self) -> SystemMetrics:
        """æ”¶é›†ç³»ç»ŸæŒ‡æ ‡"""
        return SystemMetrics(
            cpu_percent=psutil.cpu_percent(),
            memory_percent=psutil.virtual_memory().percent,
            disk_usage=psutil.disk_usage('/').percent,
            network_io=psutil.net_io_counters()._asdict(),
            timestamp=time.time()
        )

    def record_request(self, response_time: float, status_code: int):
        """è®°å½•è¯·æ±‚æŒ‡æ ‡"""
        self.request_count += 1
        self.response_times.append(response_time)

        if status_code >= 400:
            self.error_count += 1

    def get_application_metrics(self) -> Dict[str, Any]:
        """è·å–åº”ç”¨æŒ‡æ ‡"""
        uptime = time.time() - self.start_time
        avg_response_time = sum(self.response_times) / len(self.response_times) if self.response_times else 0

        return {
            'uptime': uptime,
            'request_count': self.request_count,
            'error_count': self.error_count,
            'error_rate': self.error_count / self.request_count if self.request_count > 0 else 0,
            'avg_response_time': avg_response_time,
            'requests_per_second': self.request_count / uptime if uptime > 0 else 0
        }

# å…¨å±€æŒ‡æ ‡æ”¶é›†å™¨
metrics_collector = MetricsCollector()

# ç›‘æ§ç«¯ç‚¹
@app.get("/metrics")
async def get_metrics():
    """è·å–ç›‘æ§æŒ‡æ ‡"""
    system_metrics = metrics_collector.collect_system_metrics()
    app_metrics = metrics_collector.get_application_metrics()

    return {
        'system': system_metrics,
        'application': app_metrics,
        'timestamp': time.time()
    }
```

**å¥åº·æ£€æŸ¥**
```python
# health.py
from fastapi import HTTPException
import aiohttp
import asyncio
from typing import Dict, Any

class HealthChecker:
    """å¥åº·æ£€æŸ¥å™¨"""

    async def check_database(self) -> bool:
        """æ£€æŸ¥æ•°æ®åº“è¿æ¥"""
        # è¿™é‡Œæ˜¯æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥
        try:
            from pathlib import Path
            test_dir = Path("test")
            return test_dir.exists() and test_dir.is_dir()
        except Exception:
            return False

    async def check_external_api(self) -> bool:
        """æ£€æŸ¥å¤–éƒ¨APIè¿æ¥"""
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get("https://api.deepseek.com", timeout=5) as response:
                    return response.status == 200
        except Exception:
            return False

    async def check_disk_space(self) -> bool:
        """æ£€æŸ¥ç£ç›˜ç©ºé—´"""
        try:
            import shutil
            total, used, free = shutil.disk_usage("/")
            usage_percent = (used / total) * 100
            return usage_percent < 90  # ç£ç›˜ä½¿ç”¨ç‡å°äº90%
        except Exception:
            return False

    async def get_health_status(self) -> Dict[str, Any]:
        """è·å–å¥åº·çŠ¶æ€"""
        checks = {
            'filesystem': await self.check_database(),
            'external_api': await self.check_external_api(),
            'disk_space': await self.check_disk_space()
        }

        overall_health = all(checks.values())

        return {
            'status': 'healthy' if overall_health else 'unhealthy',
            'checks': checks,
            'timestamp': time.time()
        }

health_checker = HealthChecker()

@app.get("/health")
async def health_check():
    """å¥åº·æ£€æŸ¥ç«¯ç‚¹"""
    health_status = await health_checker.get_health_status()

    if health_status['status'] == 'unhealthy':
        raise HTTPException(status_code=503, detail=health_status)

    return health_status
```

### 6.3 å‡çº§å’Œè¿ç§»æŒ‡å—

#### ç‰ˆæœ¬å‡çº§æµç¨‹

**è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†**
```
ç‰ˆæœ¬æ ¼å¼: MAJOR.MINOR.PATCH
ä¾‹å¦‚: 1.2.3

MAJOR: ä¸å…¼å®¹çš„APIä¿®æ”¹
MINOR: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
PATCH: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£
```

**å‡çº§å‰æ£€æŸ¥æ¸…å•**
- [ ] å¤‡ä»½å½“å‰é…ç½®å’Œæ•°æ®
- [ ] æ£€æŸ¥ä¾èµ–å…¼å®¹æ€§
- [ ] é˜…è¯»ç‰ˆæœ¬æ›´æ–°æ—¥å¿—
- [ ] åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- [ ] å‡†å¤‡å›æ»šæ–¹æ¡ˆ

**è‡ªåŠ¨å‡çº§è„šæœ¬**
```bash
#!/bin/bash
# scripts/upgrade.sh

set -e

CURRENT_VERSION=$(grep '"version"' manifest.json | cut -d'"' -f4)
TARGET_VERSION=$1

if [ -z "$TARGET_VERSION" ]; then
    echo "ç”¨æ³•: $0 <ç›®æ ‡ç‰ˆæœ¬>"
    echo "å½“å‰ç‰ˆæœ¬: $CURRENT_VERSION"
    exit 1
fi

echo "ğŸ”„ å‡çº§ä» $CURRENT_VERSION åˆ° $TARGET_VERSION"

# 1. å¤‡ä»½å½“å‰ç‰ˆæœ¬
echo "ğŸ“¦ åˆ›å»ºå¤‡ä»½..."
BACKUP_DIR="backups/v$CURRENT_VERSION-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"
cp -r . "$BACKUP_DIR/" 2>/dev/null || true

# 2. æ‹‰å–æ–°ç‰ˆæœ¬
echo "â¬‡ï¸  ä¸‹è½½æ–°ç‰ˆæœ¬..."
git fetch origin
git checkout "v$TARGET_VERSION"

# 3. æ›´æ–°ä¾èµ–
echo "ğŸ“¦ æ›´æ–°ä¾èµ–..."
cd server
uv sync

# 4. è¿è¡Œè¿ç§»è„šæœ¬
echo "ğŸ”„ æ‰§è¡Œè¿ç§»..."
if [ -f "scripts/migrate-$TARGET_VERSION.sh" ]; then
    bash "scripts/migrate-$TARGET_VERSION.sh"
fi

# 5. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
uv run python -m pytest test_fastapi.py -v

# 6. é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
pkill -f "python.*start_server" || true
sleep 2
uv run python start_server.py &

echo "âœ… å‡çº§å®Œæˆ!"
echo "ğŸ“ å¤‡ä»½ä½ç½®: $BACKUP_DIR"
```

#### æ•°æ®è¿ç§»

**é…ç½®æ–‡ä»¶è¿ç§»**
```python
# scripts/migrate_config.py
import json
import os
from pathlib import Path
from typing import Dict, Any

class ConfigMigrator:
    """é…ç½®æ–‡ä»¶è¿ç§»å™¨"""

    def __init__(self, old_version: str, new_version: str):
        self.old_version = old_version
        self.new_version = new_version

    def migrate_env_file(self, env_path: Path) -> None:
        """è¿ç§».envæ–‡ä»¶"""
        if not env_path.exists():
            return

        # è¯»å–ç°æœ‰é…ç½®
        config = {}
        with open(env_path, 'r') as f:
            for line in f:
                if '=' in line and not line.startswith('#'):
                    key, value = line.strip().split('=', 1)
                    config[key] = value

        # åº”ç”¨è¿ç§»è§„åˆ™
        config = self._apply_env_migrations(config)

        # å†™å›æ–‡ä»¶
        with open(env_path, 'w') as f:
            f.write("# Chromeæ‰©å±•AIåŠ©æ‰‹é…ç½®æ–‡ä»¶\n")
            f.write(f"# è¿ç§»ç‰ˆæœ¬: {self.old_version} -> {self.new_version}\n\n")

            for key, value in config.items():
                f.write(f"{key}={value}\n")

    def _apply_env_migrations(self, config: Dict[str, str]) -> Dict[str, str]:
        """åº”ç”¨ç¯å¢ƒå˜é‡è¿ç§»è§„åˆ™"""
        migrations = {
            '1.0.0': {
                # v1.0.0çš„è¿ç§»è§„åˆ™
                'renames': {
                    'API_KEY': 'DEEPSEEK_API_KEY',
                    'SERVER_URL': 'SERVER_HOST'
                },
                'additions': {
                    'LOG_LEVEL': 'INFO',
                    'MAX_MESSAGE_LENGTH': '10000'
                },
                'removals': ['OLD_CONFIG_KEY']
            }
        }

        if self.new_version in migrations:
            rules = migrations[self.new_version]

            # é‡å‘½å
            for old_key, new_key in rules.get('renames', {}).items():
                if old_key in config:
                    config[new_key] = config.pop(old_key)

            # æ·»åŠ æ–°é…ç½®
            for key, default_value in rules.get('additions', {}).items():
                if key not in config:
                    config[key] = default_value

            # åˆ é™¤åºŸå¼ƒé…ç½®
            for key in rules.get('removals', []):
                config.pop(key, None)

        return config

    def migrate_manifest(self, manifest_path: Path) -> None:
        """è¿ç§»manifest.jsonæ–‡ä»¶"""
        if not manifest_path.exists():
            return

        with open(manifest_path, 'r') as f:
            manifest = json.load(f)

        # æ›´æ–°ç‰ˆæœ¬å·
        manifest['version'] = self.new_version

        # åº”ç”¨manifestè¿ç§»è§„åˆ™
        manifest = self._apply_manifest_migrations(manifest)

        with open(manifest_path, 'w') as f:
            json.dump(manifest, f, indent=2, ensure_ascii=False)

    def _apply_manifest_migrations(self, manifest: Dict[str, Any]) -> Dict[str, Any]:
        """åº”ç”¨manifestè¿ç§»è§„åˆ™"""
        # ç¤ºä¾‹ï¼šæ·»åŠ æ–°æƒé™
        if self.new_version >= '1.1.0':
            if 'activeTab' not in manifest.get('permissions', []):
                manifest.setdefault('permissions', []).append('activeTab')

        return manifest

def run_migration(old_version: str, new_version: str):
    """è¿è¡Œè¿ç§»"""
    migrator = ConfigMigrator(old_version, new_version)

    # è¿ç§»é…ç½®æ–‡ä»¶
    migrator.migrate_env_file(Path('server/.env'))
    migrator.migrate_manifest(Path('manifest.json'))

    print(f"âœ… é…ç½®è¿ç§»å®Œæˆ: {old_version} -> {new_version}")

if __name__ == "__main__":
    import sys
    if len(sys.argv) != 3:
        print("ç”¨æ³•: python migrate_config.py <æ—§ç‰ˆæœ¬> <æ–°ç‰ˆæœ¬>")
        sys.exit(1)

    run_migration(sys.argv[1], sys.argv[2])
```

#### å›æ»šæ–¹æ¡ˆ

**è‡ªåŠ¨å›æ»šè„šæœ¬**
```bash
#!/bin/bash
# scripts/rollback.sh

set -e

BACKUP_DIR=$1

if [ -z "$BACKUP_DIR" ] || [ ! -d "$BACKUP_DIR" ]; then
    echo "ç”¨æ³•: $0 <å¤‡ä»½ç›®å½•>"
    echo "å¯ç”¨å¤‡ä»½:"
    ls -la backups/ 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°å¤‡ä»½"
    exit 1
fi

echo "ğŸ”„ å›æ»šåˆ°å¤‡ä»½: $BACKUP_DIR"

# 1. åœæ­¢å½“å‰æœåŠ¡
echo "ğŸ›‘ åœæ­¢æœåŠ¡..."
pkill -f "python.*start_server" || true

# 2. å¤‡ä»½å½“å‰çŠ¶æ€ï¼ˆä»¥é˜²å›æ»šå¤±è´¥ï¼‰
CURRENT_BACKUP="backups/pre-rollback-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$CURRENT_BACKUP"
cp -r . "$CURRENT_BACKUP/" 2>/dev/null || true

# 3. æ¢å¤æ–‡ä»¶
echo "ğŸ“ æ¢å¤æ–‡ä»¶..."
rsync -av --delete "$BACKUP_DIR/" ./ --exclude=backups/

# 4. æ¢å¤ä¾èµ–
echo "ğŸ“¦ æ¢å¤ä¾èµ–..."
cd server
uv sync

# 5. éªŒè¯å›æ»š
echo "ğŸ§ª éªŒè¯å›æ»š..."
if uv run python -c "import main; print('å¯¼å…¥æˆåŠŸ')"; then
    echo "âœ… å›æ»šéªŒè¯æˆåŠŸ"
else
    echo "âŒ å›æ»šéªŒè¯å¤±è´¥"
    exit 1
fi

# 6. é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
uv run python start_server.py &

echo "âœ… å›æ»šå®Œæˆ!"
echo "ğŸ“ å½“å‰çŠ¶æ€å¤‡ä»½: $CURRENT_BACKUP"
```

#### æ•…éšœæ’æŸ¥

**å¸¸è§å‡çº§é—®é¢˜**

**é—®é¢˜1: ä¾èµ–å†²çª**
```bash
# ç—‡çŠ¶: uv syncå¤±è´¥ï¼Œä¾èµ–ç‰ˆæœ¬å†²çª
# è§£å†³æ–¹æ¡ˆ:
cd server

# æ¸…ç†ä¾èµ–ç¼“å­˜
uv cache clean

# é‡æ–°ç”Ÿæˆé”æ–‡ä»¶
rm uv.lock
uv sync

# å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥pyproject.tomlä¸­çš„ç‰ˆæœ¬çº¦æŸ
```

**é—®é¢˜2: é…ç½®æ–‡ä»¶æ ¼å¼å˜æ›´**
```bash
# ç—‡çŠ¶: æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œé…ç½®è§£æé”™è¯¯
# è§£å†³æ–¹æ¡ˆ:
cd server

# æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
python -c "
import os
from dotenv import load_dotenv
load_dotenv()
print('é…ç½®åŠ è½½æˆåŠŸ')
"

# æ‰‹åŠ¨è¿è¡Œè¿ç§»è„šæœ¬
python ../scripts/migrate_config.py 1.0.0 1.1.0
```

**é—®é¢˜3: Chromeæ‰©å±•åŠ è½½å¤±è´¥**
```bash
# ç—‡çŠ¶: æ‰©å±•åœ¨Chromeä¸­æ˜¾ç¤ºé”™è¯¯
# è§£å†³æ–¹æ¡ˆ:

# æ£€æŸ¥manifest.jsonè¯­æ³•
cat manifest.json | jq .

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la *.js *.html *.css

# é‡æ–°åŠ è½½æ‰©å±•
# åœ¨chrome://extensions/é¡µé¢ç‚¹å‡»åˆ·æ–°æŒ‰é’®
```

**é—®é¢˜4: APIå…¼å®¹æ€§é—®é¢˜**
```bash
# ç—‡çŠ¶: å‰ç«¯æ— æ³•è¿æ¥åç«¯
# è§£å†³æ–¹æ¡ˆ:

# æ£€æŸ¥APIç«¯ç‚¹
curl -f http://127.0.0.1:5001/docs

# æ£€æŸ¥CORSé…ç½®
curl -H "Origin: chrome-extension://test" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS \
     http://127.0.0.1:5001/chat

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f server/logs/app.log
```

#### ç»´æŠ¤æœ€ä½³å®è·µ

**å®šæœŸç»´æŠ¤ä»»åŠ¡**
```bash
#!/bin/bash
# scripts/maintenance.sh

echo "ğŸ”§ æ‰§è¡Œå®šæœŸç»´æŠ¤..."

# 1. æ¸…ç†æ—¥å¿—æ–‡ä»¶
echo "ğŸ—‘ï¸  æ¸…ç†æ—§æ—¥å¿—..."
find server/logs -name "*.log" -mtime +30 -delete

# 2. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
echo "ğŸ—‘ï¸  æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
find server/test -name "*.tmp" -delete
find server/test -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true

# 3. æ›´æ–°ä¾èµ–
echo "ğŸ“¦ æ£€æŸ¥ä¾èµ–æ›´æ–°..."
cd server
uv pip list --outdated

# 4. è¿è¡Œå¥åº·æ£€æŸ¥
echo "ğŸ¥ è¿è¡Œå¥åº·æ£€æŸ¥..."
curl -f http://127.0.0.1:5001/health || echo "å¥åº·æ£€æŸ¥å¤±è´¥"

# 5. å¤‡ä»½é…ç½®
echo "ğŸ’¾ å¤‡ä»½é…ç½®..."
BACKUP_DIR="backups/maintenance-$(date +%Y%m%d)"
mkdir -p "$BACKUP_DIR"
cp .env "$BACKUP_DIR/" 2>/dev/null || true
cp ../manifest.json "$BACKUP_DIR/" 2>/dev/null || true

# 6. æ€§èƒ½æ£€æŸ¥
echo "âš¡ æ€§èƒ½æ£€æŸ¥..."
curl -s http://127.0.0.1:5001/metrics | jq .

echo "âœ… ç»´æŠ¤å®Œæˆ!"
```

**ç›‘æ§å‘Šè­¦**
```python
# scripts/monitor.py
import requests
import smtplib
from email.mime.text import MIMEText
import time
import logging

class AlertManager:
    """å‘Šè­¦ç®¡ç†å™¨"""

    def __init__(self, smtp_server: str, smtp_port: int, email: str, password: str):
        self.smtp_server = smtp_server
        self.smtp_port = smtp_port
        self.email = email
        self.password = password
        self.logger = logging.getLogger(__name__)

    def send_alert(self, subject: str, message: str, to_email: str):
        """å‘é€å‘Šè­¦é‚®ä»¶"""
        try:
            msg = MIMEText(message)
            msg['Subject'] = subject
            msg['From'] = self.email
            msg['To'] = to_email

            with smtplib.SMTP(self.smtp_server, self.smtp_port) as server:
                server.starttls()
                server.login(self.email, self.password)
                server.send_message(msg)

            self.logger.info(f"å‘Šè­¦é‚®ä»¶å·²å‘é€: {subject}")
        except Exception as e:
            self.logger.error(f"å‘é€å‘Šè­¦é‚®ä»¶å¤±è´¥: {e}")

    def check_service_health(self, url: str) -> bool:
        """æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€"""
        try:
            response = requests.get(f"{url}/health", timeout=10)
            return response.status_code == 200
        except Exception as e:
            self.logger.error(f"å¥åº·æ£€æŸ¥å¤±è´¥: {e}")
            return False

    def monitor_loop(self, service_url: str, alert_email: str, check_interval: int = 300):
        """ç›‘æ§å¾ªç¯"""
        consecutive_failures = 0
        max_failures = 3

        while True:
            if self.check_service_health(service_url):
                consecutive_failures = 0
                self.logger.info("æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡")
            else:
                consecutive_failures += 1
                self.logger.warning(f"æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥ ({consecutive_failures}/{max_failures})")

                if consecutive_failures >= max_failures:
                    self.send_alert(
                        "Chromeæ‰©å±•AIåŠ©æ‰‹æœåŠ¡å‘Šè­¦",
                        f"æœåŠ¡è¿ç»­{consecutive_failures}æ¬¡å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œè¯·ç«‹å³æ£€æŸ¥ï¼",
                        alert_email
                    )
                    consecutive_failures = 0  # é‡ç½®è®¡æ•°å™¨ï¼Œé¿å…é‡å¤å‘Šè­¦

            time.sleep(check_interval)

if __name__ == "__main__":
    import os
    from dotenv import load_dotenv

    load_dotenv()

    alert_manager = AlertManager(
        smtp_server=os.getenv('SMTP_SERVER', 'smtp.gmail.com'),
        smtp_port=int(os.getenv('SMTP_PORT', '587')),
        email=os.getenv('ALERT_EMAIL'),
        password=os.getenv('ALERT_PASSWORD')
    )

    alert_manager.monitor_loop(
        service_url='http://127.0.0.1:5001',
        alert_email=os.getenv('ADMIN_EMAIL'),
        check_interval=300  # 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    )
```

---

## ğŸ“š é™„å½•

### A. å®Œæ•´é…ç½®æ–‡ä»¶ç¤ºä¾‹

#### .env.example
```bash
# ===========================================
# Chromeæ‰©å±•AIåŠ©æ‰‹é…ç½®æ–‡ä»¶
# ===========================================

# APIé…ç½® - å¿…éœ€è®¾ç½®
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TAVILY_API_KEY=tvly-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# æœåŠ¡å™¨é…ç½®
SERVER_HOST=127.0.0.1
SERVER_PORT=5001
DEBUG=true

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
STRUCTURED_LOGGING=true

# å®‰å…¨é…ç½®
MAX_MESSAGE_LENGTH=10000
RATE_LIMIT_PER_MINUTE=60
CORS_ORIGINS=chrome-extension://*,http://localhost:*

# AIæ¨¡å‹é…ç½®
DEFAULT_MODEL=deepseek-chat
API_TIMEOUT=30
MAX_RETRIES=3

# ç›‘æ§é…ç½®
ENABLE_METRICS=true
METRICS_PORT=9090

# é‚®ä»¶å‘Šè­¦é…ç½®
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
ALERT_EMAIL=your-email@example.com
ALERT_PASSWORD=your-app-password
ADMIN_EMAIL=admin@example.com
```

### B. æ•…éšœæ’æŸ¥æ£€æŸ¥æ¸…å•

#### Chromeæ‰©å±•é—®é¢˜
- [ ] æ£€æŸ¥manifest.jsonè¯­æ³•æ˜¯å¦æ­£ç¡®
- [ ] ç¡®è®¤æƒé™é…ç½®æ˜¯å¦å®Œæ•´
- [ ] éªŒè¯æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- [ ] æ£€æŸ¥Chromeç‰ˆæœ¬æ˜¯å¦æ”¯æŒManifest V3
- [ ] æŸ¥çœ‹Chromeæ‰©å±•é”™è¯¯æ—¥å¿—
- [ ] ç¡®è®¤ä¾§è¾¹æ APIæ˜¯å¦å¯ç”¨
- [ ] æ£€æŸ¥å­˜å‚¨APIæƒé™

#### åç«¯æœåŠ¡é—®é¢˜
- [ ] ç¡®è®¤Pythonç‰ˆæœ¬ >= 3.10
- [ ] æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
- [ ] éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
- [ ] ç¡®è®¤ç«¯å£5001æ˜¯å¦è¢«å ç”¨
- [ ] æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
- [ ] éªŒè¯æ–‡ä»¶ç³»ç»Ÿæƒé™
- [ ] æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯

#### ç½‘ç»œè¿æ¥é—®é¢˜
- [ ] ç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- [ ] æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- [ ] éªŒè¯CORSé…ç½®
- [ ] æµ‹è¯•APIç«¯ç‚¹å¯è®¿é—®æ€§
- [ ] æ£€æŸ¥DNSè§£æ
- [ ] éªŒè¯SSLè¯ä¹¦ï¼ˆå¦‚æœä½¿ç”¨HTTPSï¼‰

### C. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### å‰ç«¯ä¼˜åŒ–
- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ¶ˆæ¯
- å®ç°æ¶ˆæ¯æ‡’åŠ è½½
- ä¼˜åŒ–Markdownæ¸²æŸ“æ€§èƒ½
- å‡å°‘DOMæ“ä½œé¢‘ç‡
- ä½¿ç”¨Web Workerså¤„ç†é‡è®¡ç®—

#### åç«¯ä¼˜åŒ–
- å®ç°å“åº”ç¼“å­˜
- ä½¿ç”¨è¿æ¥æ± 
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- å®ç°å¼‚æ­¥å¤„ç†
- æ·»åŠ é€Ÿç‡é™åˆ¶

#### ç³»ç»Ÿä¼˜åŒ–
- é…ç½®åå‘ä»£ç†
- å¯ç”¨Gzipå‹ç¼©
- ä½¿ç”¨CDNåŠ é€Ÿ
- å®ç°è´Ÿè½½å‡è¡¡
- ç›‘æ§èµ„æºä½¿ç”¨

### D. å®‰å…¨æœ€ä½³å®è·µ

#### APIå®‰å…¨
- ä½¿ç”¨HTTPSä¼ è¾“
- å®ç°APIå¯†é’¥è½®æ¢
- æ·»åŠ è¯·æ±‚ç­¾åéªŒè¯
- å®ç°IPç™½åå•
- ç›‘æ§å¼‚å¸¸è®¿é—®

#### æ•°æ®å®‰å…¨
- åŠ å¯†æ•æ„Ÿæ•°æ®
- å®ç°æ•°æ®å¤‡ä»½
- å®šæœŸå®‰å…¨å®¡è®¡
- æœ€å°æƒé™åŸåˆ™
- å®‰å…¨æ—¥å¿—è®°å½•

### E. ç›¸å…³èµ„æºé“¾æ¥

#### å®˜æ–¹æ–‡æ¡£
- [Chromeæ‰©å±•å¼€å‘æ–‡æ¡£](https://developer.chrome.com/docs/extensions/)
- [FastAPIå®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [pydantic-aiæ–‡æ¡£](https://ai.pydantic.dev/)
- [uvåŒ…ç®¡ç†å™¨æ–‡æ¡£](https://docs.astral.sh/uv/)

#### ç¤¾åŒºèµ„æº
- [Chromeæ‰©å±•å¼€å‘ç¤¾åŒº](https://groups.google.com/a/chromium.org/g/chromium-extensions)
- [FastAPI GitHub](https://github.com/tiangolo/fastapi)
- [Chromeæ‰©å±•ç¤ºä¾‹](https://github.com/GoogleChrome/chrome-extensions-samples)

#### å·¥å…·å’Œåº“
- [marked.js](https://marked.js.org/)
- [highlight.js](https://highlightjs.org/)
- [Chrome DevTools](https://developer.chrome.com/docs/devtools/)

---

**ğŸ“ æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**ğŸ“… æœ€åæ›´æ–°**: 2024å¹´12æœˆ
**ğŸ‘¥ ç»´æŠ¤å›¢é˜Ÿ**: Chromeæ‰©å±•AIåŠ©æ‰‹å¼€å‘å›¢é˜Ÿ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š
- ğŸ› **é—®é¢˜æŠ¥å‘Š**: [GitHub Issues](https://github.com/your-repo/issues)
- ğŸ’¬ **è®¨è®ºäº¤æµ**: [GitHub Discussions](https://github.com/your-repo/discussions)
- ğŸ“§ **é‚®ä»¶è”ç³»**: support@example.com

æ„Ÿè°¢æ‚¨ä½¿ç”¨Chromeæ‰©å±•AIåŠ©æ‰‹ï¼ğŸš€

---

